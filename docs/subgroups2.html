<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11 Subgroup-based analysis | User’s guide for LTabundR</title>
  <meta name="description" content="vignette" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="11 Subgroup-based analysis | User’s guide for LTabundR" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="vignette" />
  <meta name="github-repo" content="emk-noaa/emk-noaa.github.io" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 Subgroup-based analysis | User’s guide for LTabundR" />
  
  <meta name="twitter:description" content="vignette" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="trend-analysis.html"/>
<link rel="next" href="diagnostic-plots.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.31.1/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="libs/dt-ext-fixedcolumns-1.13.6/css/fixedColumns.dataTables.min.css" rel="stylesheet" />
<script src="libs/dt-ext-fixedcolumns-1.13.6/js/dataTables.fixedColumns.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.0/leaflet.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#credits"><i class="fa fa-check"></i>Credits</a></li>
</ul></li>
<li class="part"><span><b>I Data processing</b></span></li>
<li class="chapter" data-level="1" data-path="settings.html"><a href="settings.html"><i class="fa fa-check"></i><b>1</b> Settings</a>
<ul>
<li class="chapter" data-level="" data-path="settings.html"><a href="settings.html#survey-strata"><i class="fa fa-check"></i>Survey strata</a></li>
<li class="chapter" data-level="" data-path="settings.html"><a href="settings.html#survey-wide-settings"><i class="fa fa-check"></i>Survey-wide settings</a>
<ul>
<li class="chapter" data-level="" data-path="settings.html"><a href="settings.html#defaults"><i class="fa fa-check"></i>Defaults</a></li>
<li class="chapter" data-level="" data-path="settings.html"><a href="settings.html#details"><i class="fa fa-check"></i>Details</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="settings.html"><a href="settings.html#cohort-specific-settings"><i class="fa fa-check"></i>Cohort-specific settings</a>
<ul>
<li class="chapter" data-level="" data-path="settings.html"><a href="settings.html#defaults-1"><i class="fa fa-check"></i>Defaults</a></li>
<li class="chapter" data-level="" data-path="settings.html"><a href="settings.html#details-1"><i class="fa fa-check"></i>Details</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="settings.html"><a href="settings.html#example-code"><i class="fa fa-check"></i>Example code</a>
<ul>
<li class="chapter" data-level="" data-path="settings.html"><a href="settings.html#use-settings-defaults"><i class="fa fa-check"></i>Use settings defaults</a></li>
<li class="chapter" data-level="" data-path="settings.html"><a href="settings.html#use-settings-defaults-but-with-strata"><i class="fa fa-check"></i>Use settings defaults, but with strata</a></li>
<li class="chapter" data-level="" data-path="settings.html"><a href="settings.html#customize-survey-but-not-cohorts"><i class="fa fa-check"></i>Customize survey, but not cohorts</a></li>
<li class="chapter" data-level="" data-path="settings.html"><a href="settings.html#fully-custom-whiceas-case-study"><i class="fa fa-check"></i>Fully custom: WHICEAS case study</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="das.html"><a href="das.html"><i class="fa fa-check"></i><b>2</b> DAS editing</a>
<ul>
<li class="chapter" data-level="" data-path="das.html"><a href="das.html#reviewing-a-das-file"><i class="fa fa-check"></i>Reviewing a <code>DAS</code> file</a>
<ul>
<li class="chapter" data-level="" data-path="das.html"><a href="das.html#das_readtext"><i class="fa fa-check"></i><code>das_readtext()</code></a></li>
<li class="chapter" data-level="" data-path="das.html"><a href="das.html#das_inspector"><i class="fa fa-check"></i><code>das_inspector()</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="das.html"><a href="das.html#staging-edits"><i class="fa fa-check"></i>Staging edits</a>
<ul>
<li class="chapter" data-level="" data-path="das.html"><a href="das.html#types-of-editing"><i class="fa fa-check"></i>Types of editing</a></li>
<li class="chapter" data-level="" data-path="das.html"><a href="das.html#actual-edits"><i class="fa fa-check"></i>Actual edits</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="das.html"><a href="das.html#applying-edits"><i class="fa fa-check"></i>Applying edits</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="processing.html"><a href="processing.html"><i class="fa fa-check"></i><b>3</b> Data processing</a>
<ul>
<li class="chapter" data-level="" data-path="processing.html"><a href="processing.html#behind-the-scenes"><i class="fa fa-check"></i>Behind the scenes</a>
<ul>
<li class="chapter" data-level="" data-path="processing.html"><a href="processing.html#edit-cruise-data"><i class="fa fa-check"></i>Edit cruise data</a></li>
<li class="chapter" data-level="" data-path="processing.html"><a href="processing.html#bring-in-cruise-data"><i class="fa fa-check"></i>Bring in cruise data</a></li>
<li class="chapter" data-level="" data-path="processing.html"><a href="processing.html#interpolate-cruise-data"><i class="fa fa-check"></i>Interpolate cruise data</a></li>
<li class="chapter" data-level="" data-path="processing.html"><a href="processing.html#process-strata"><i class="fa fa-check"></i>Process strata</a></li>
<li class="chapter" data-level="" data-path="processing.html"><a href="processing.html#format-das-data-into-a-cruz-object"><i class="fa fa-check"></i>Format <code>DAS</code> data into a <code>cruz</code> object</a></li>
<li class="chapter" data-level="" data-path="processing.html"><a href="processing.html#the-cruz-object"><i class="fa fa-check"></i>The <code>cruz</code> object</a></li>
<li class="chapter" data-level="" data-path="processing.html"><a href="processing.html#segmentize-the-data"><i class="fa fa-check"></i>Segmentize the data</a></li>
<li class="chapter" data-level="" data-path="processing.html"><a href="processing.html#process-sightings"><i class="fa fa-check"></i>Process sightings</a></li>
<li class="chapter" data-level="" data-path="processing.html"><a href="processing.html#subgroups"><i class="fa fa-check"></i>Process subgroups</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="processing.html"><a href="processing.html#review"><i class="fa fa-check"></i>Review</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="filter.html"><a href="filter.html"><i class="fa fa-check"></i><b>4</b> Filter &amp; combine surveys</a>
<ul>
<li class="chapter" data-level="" data-path="filter.html"><a href="filter.html#filter-1"><i class="fa fa-check"></i>Filter</a></li>
<li class="chapter" data-level="" data-path="filter.html"><a href="filter.html#combine"><i class="fa fa-check"></i>Combine</a></li>
</ul></li>
<li class="part"><span><b>II Data exploration</b></span></li>
<li class="chapter" data-level="5" data-path="summarize.html"><a href="summarize.html"><i class="fa fa-check"></i><b>5</b> Summarize survey</a>
<ul>
<li class="chapter" data-level="" data-path="summarize.html"><a href="summarize.html#summarize-effort"><i class="fa fa-check"></i>Summarize effort</a></li>
<li class="chapter" data-level="" data-path="summarize.html"><a href="summarize.html#summarize-by-beaufort"><i class="fa fa-check"></i>Summarize by Beaufort</a>
<ul>
<li class="chapter" data-level="" data-path="summarize.html"><a href="summarize.html#simple-overall-breakdown"><i class="fa fa-check"></i>Simple overall breakdown</a></li>
<li class="chapter" data-level="" data-path="summarize.html"><a href="summarize.html#breakdown-by-year"><i class="fa fa-check"></i>Breakdown by year</a></li>
<li class="chapter" data-level="" data-path="summarize.html"><a href="summarize.html#breakdown-by-stratum"><i class="fa fa-check"></i>Breakdown by stratum</a></li>
<li class="chapter" data-level="" data-path="summarize.html"><a href="summarize.html#detailed-breakdown"><i class="fa fa-check"></i>Detailed breakdown</a></li>
<li class="chapter" data-level="5.0.1" data-path="summarize.html"><a href="summarize.html#default-filtering"><i class="fa fa-check"></i><b>5.0.1</b> Default filtering</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="summarize.html"><a href="summarize.html#summarize-sightings"><i class="fa fa-check"></i>Summarize sightings</a></li>
<li class="chapter" data-level="" data-path="summarize.html"><a href="summarize.html#summarize-certain-species"><i class="fa fa-check"></i>Summarize certain species</a></li>
<li class="chapter" data-level="" data-path="summarize.html"><a href="summarize.html#cruz_explorer"><i class="fa fa-check"></i><code>cruz_explorer()</code></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>6</b> Maps</a>
<ul>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#creating-a-base-map"><i class="fa fa-check"></i>Creating a base map</a></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#add-stratum-boundaries"><i class="fa fa-check"></i>Add stratum boundaries</a></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#add-effort-tracklines"><i class="fa fa-check"></i>Add effort tracklines</a></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#add-sightings"><i class="fa fa-check"></i>Add sightings</a></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#other-base-maps"><i class="fa fa-check"></i>Other base maps</a>
<ul>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#hawaiian-eez"><i class="fa fa-check"></i>Hawaiian EEZ</a></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#california-current-system"><i class="fa fa-check"></i>California Current System</a></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#eastern-tropical-pacific"><i class="fa fa-check"></i>Eastern tropical Pacific</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#interactive-maps"><i class="fa fa-check"></i>Interactive maps</a></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#interactive-dashboard"><i class="fa fa-check"></i>Interactive dashboard</a></li>
</ul></li>
<li class="part"><span><b>III Data analysis</b></span></li>
<li class="chapter" data-level="7" data-path="g0.html"><a href="g0.html"><i class="fa fa-check"></i><b>7</b> Estimating <em>g(0)</em></a>
<ul>
<li class="chapter" data-level="" data-path="g0.html"><a href="g0.html#relative-g0"><i class="fa fa-check"></i>Relative <code>g(0)</code></a>
<ul>
<li class="chapter" data-level="" data-path="g0.html"><a href="g0.html#archived-rg0-estimates"><i class="fa fa-check"></i>Archived <em>Rg(0)</em> estimates</a></li>
<li class="chapter" data-level="" data-path="g0.html"><a href="g0.html#new-rg0-estimates"><i class="fa fa-check"></i>New <em>Rg(0)</em> estimates</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g0.html"><a href="g0.html#weighted-average-g0"><i class="fa fa-check"></i>Weighted average <code>g(0)</code></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="lta.html"><a href="lta.html"><i class="fa fa-check"></i><b>8</b> Line-transect analysis</a>
<ul>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#overview-1"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#key-inputs"><i class="fa fa-check"></i>Key inputs</a>
<ul>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#cruz"><i class="fa fa-check"></i><code>cruz</code></a></li>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#rg0"><i class="fa fa-check"></i><code>Rg0</code></a></li>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#fit_filters"><i class="fa fa-check"></i><code>fit_filters</code></a></li>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#df_settings"><i class="fa fa-check"></i><code>df_settings</code></a></li>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#estimates"><i class="fa fa-check"></i><code>estimates</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#variance-estimation"><i class="fa fa-check"></i>Variance estimation</a></li>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#other-inputs"><i class="fa fa-check"></i>Other inputs</a></li>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#output"><i class="fa fa-check"></i>Output</a>
<ul>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#during-processing"><i class="fa fa-check"></i>During processing</a></li>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#outputs"><i class="fa fa-check"></i>Outputs</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#unusual-estimate-scenarios"><i class="fa fa-check"></i>Unusual estimate scenarios</a>
<ul>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#species-combinations-g0"><i class="fa fa-check"></i>Species combinations &amp; <em>g(0)</em></a></li>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#geostratum-combinations"><i class="fa fa-check"></i>Geostratum combinations</a></li>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#subgroup-based-analyses"><i class="fa fa-check"></i>Subgroup-based analyses</a></li>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#other-scenarios"><i class="fa fa-check"></i>Other scenarios</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#behind-the-scenes-1"><i class="fa fa-check"></i>Behind the scenes</a>
<ul>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#step-by-step-operations"><i class="fa fa-check"></i>Step-by-step operations</a></li>
<li class="chapter" data-level="" data-path="lta.html"><a href="lta.html#other-details"><i class="fa fa-check"></i>Other details</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="destratify.html"><a href="destratify.html"><i class="fa fa-check"></i><b>9</b> Stratified analysis</a></li>
<li class="chapter" data-level="10" data-path="trend-analysis.html"><a href="trend-analysis.html"><i class="fa fa-check"></i><b>10</b> Trend analysis</a></li>
<li class="chapter" data-level="11" data-path="subgroups2.html"><a href="subgroups2.html"><i class="fa fa-check"></i><b>11</b> Subgroup-based analysis</a>
<ul>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#manual-data-updates"><i class="fa fa-check"></i>Manual data updates</a>
<ul>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#reviewing-processed-subgroup-data"><i class="fa fa-check"></i>Reviewing processed subgroup data</a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#staging-subgroup-edits"><i class="fa fa-check"></i>Staging subgroup edits</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#inputs-to-lta_subgroup"><i class="fa fa-check"></i>Inputs to <code>lta_subgroup()</code></a>
<ul>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#df_sits"><i class="fa fa-check"></i><code>df_sits</code></a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#truncation_distance"><i class="fa fa-check"></i><code>truncation_distance</code></a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#ss"><i class="fa fa-check"></i><code>ss</code></a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#rg0-1"><i class="fa fa-check"></i><code>Rg0</code></a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#cruz10"><i class="fa fa-check"></i><code>cruz10</code></a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#g0_spp"><i class="fa fa-check"></i><code>g0_spp</code></a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#g0_truncation"><i class="fa fa-check"></i><code>g0_truncation</code></a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#g0_constrain_shape"><i class="fa fa-check"></i><code>g0_constrain_shape</code></a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#g0_jackknife_fraction"><i class="fa fa-check"></i><code>g0_jackknife_fraction</code></a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#density_segments"><i class="fa fa-check"></i><code>density_segments</code></a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#density_das"><i class="fa fa-check"></i><code>density_das</code></a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#density_sightings"><i class="fa fa-check"></i><code>density_sightings</code></a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#abundance_area"><i class="fa fa-check"></i><code>abundance_area</code></a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#remaining-inputs"><i class="fa fa-check"></i>Remaining inputs</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#running-lta_subgroup"><i class="fa fa-check"></i>Running <code>lta_subgroup()</code></a>
<ul>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#hawaii-eez-stratum"><i class="fa fa-check"></i>Hawaii EEZ stratum</a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#northwest-hawaiian-islands-stratum"><i class="fa fa-check"></i>Northwest Hawaiian Islands stratum</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#outputs-1"><i class="fa fa-check"></i>Outputs</a></li>
<li class="chapter" data-level="" data-path="subgroups2.html"><a href="subgroups2.html#behind-the-scenes-2"><i class="fa fa-check"></i>Behind the scenes</a></li>
</ul></li>
<li class="part"><span><b>IV Results</b></span></li>
<li class="chapter" data-level="12" data-path="diagnostic-plots.html"><a href="diagnostic-plots.html"><i class="fa fa-check"></i><b>12</b> Diagnostic plots</a></li>
<li class="chapter" data-level="13" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>13</b> Tables</a>
<ul>
<li class="chapter" data-level="" data-path="tables.html"><a href="tables.html#summary-tables"><i class="fa fa-check"></i>Summary tables</a>
<ul>
<li class="chapter" data-level="" data-path="tables.html"><a href="tables.html#table-1-in-reports-sample-sizes"><i class="fa fa-check"></i>Table 1 in reports: Sample sizes</a></li>
<li class="chapter" data-level="" data-path="tables.html"><a href="tables.html#table-2-in-reports-detection-functions"><i class="fa fa-check"></i>Table 2 in reports: Detection functions</a></li>
<li class="chapter" data-level="" data-path="tables.html"><a href="tables.html#table-3-parameter-estimates"><i class="fa fa-check"></i>Table 3: Parameter estimates</a></li>
<li class="chapter" data-level="" data-path="tables.html"><a href="tables.html#table-4-densityabundance"><i class="fa fa-check"></i>Table 4: Density/abundance</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tables.html"><a href="tables.html#appendix-tables"><i class="fa fa-check"></i>Appendix tables</a>
<ul>
<li class="chapter" data-level="" data-path="tables.html"><a href="tables.html#table-a1-study-areas"><i class="fa fa-check"></i>Table A1: Study areas</a></li>
<li class="chapter" data-level="" data-path="tables.html"><a href="tables.html#table-a2-effort-totals-parsed-by-beaufort-sea-state"><i class="fa fa-check"></i>Table A2: Effort totals (parsed by Beaufort sea state)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="plots.html"><a href="plots.html"><i class="fa fa-check"></i><b>14</b> Plots</a>
<ul>
<li class="chapter" data-level="" data-path="plots.html"><a href="plots.html#abundance-plots"><i class="fa fa-check"></i>Abundance plots</a></li>
<li class="chapter" data-level="" data-path="plots.html"><a href="plots.html#detection-function-plots"><i class="fa fa-check"></i>Detection function plots</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="combining-lta-results.html"><a href="combining-lta-results.html"><i class="fa fa-check"></i><b>15</b> Combining <code>lta()</code> results</a></li>
<li class="part"><span><b>V Case studies</b></span></li>
<li class="chapter" data-level="16" data-path="whiceas.html"><a href="whiceas.html"><i class="fa fa-check"></i><b>16</b> WHICEAS</a>
<ul>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#data-processing"><i class="fa fa-check"></i>Data processing</a>
<ul>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#edits"><i class="fa fa-check"></i>Edits</a></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#settings-1"><i class="fa fa-check"></i>Settings</a></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#process"><i class="fa fa-check"></i>Process</a></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#processed-data-structure"><i class="fa fa-check"></i>Processed data structure</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#rg0-2"><i class="fa fa-check"></i>Rg0</a></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#density-abundance"><i class="fa fa-check"></i>Density &amp; abundance</a>
<ul>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#multi-species-pool-1"><i class="fa fa-check"></i>Multi-species pool 1</a></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#multi-species-pool-2"><i class="fa fa-check"></i>Multi-species pool 2</a></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#multi-species-pool-3"><i class="fa fa-check"></i>Multi-species pool 3</a></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#multi-species-pool-4"><i class="fa fa-check"></i>Multi-species pool 4</a></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#multi-species-pool-5"><i class="fa fa-check"></i>Multi-species pool 5</a></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#multi-species-pool-6"><i class="fa fa-check"></i>Multi-species pool 6</a></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#humpback-whale"><i class="fa fa-check"></i>Humpback whale</a></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#unidentified-rorquals"><i class="fa fa-check"></i>Unidentified rorquals</a></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#unidentified-dolphins"><i class="fa fa-check"></i>Unidentified dolphins</a></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#unidentified-cetaceans"><i class="fa fa-check"></i>Unidentified cetaceans</a></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#bottlenose-dolphin"><i class="fa fa-check"></i>Bottlenose dolphin</a></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#pantropical-spotted-dolphin"><i class="fa fa-check"></i>Pantropical spotted dolphin</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="whiceas.html"><a href="whiceas.html#results-tables"><i class="fa fa-check"></i>Results tables</a></li>
</ul></li>
<li class="part"><span><b>VI Appendix</b></span></li>
<li class="chapter" data-level="17" data-path="stratagallery.html"><a href="stratagallery.html"><i class="fa fa-check"></i><b>17</b> Strata gallery</a>
<ul>
<li class="chapter" data-level="" data-path="stratagallery.html"><a href="stratagallery.html#central-north-pacific"><i class="fa fa-check"></i>Central North Pacific</a></li>
<li class="chapter" data-level="" data-path="stratagallery.html"><a href="stratagallery.html#california-current"><i class="fa fa-check"></i>California Current</a></li>
<li class="chapter" data-level="" data-path="stratagallery.html"><a href="stratagallery.html#etp"><i class="fa fa-check"></i>ETP</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="segmentizing.html"><a href="segmentizing.html"><i class="fa fa-check"></i><b>18</b> Segmentizing</a>
<ul>
<li class="chapter" data-level="" data-path="segmentizing.html"><a href="segmentizing.html#approach"><i class="fa fa-check"></i>Approach</a>
<ul>
<li class="chapter" data-level="" data-path="segmentizing.html"><a href="segmentizing.html#setting-up-this-demo"><i class="fa fa-check"></i>Setting up this demo</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="segmentizing.html"><a href="segmentizing.html#base-example"><i class="fa fa-check"></i>Base example</a></li>
<li class="chapter" data-level="" data-path="segmentizing.html"><a href="segmentizing.html#day-vs-equal-length"><i class="fa fa-check"></i>Day vs Equal Length</a>
<ul>
<li class="chapter" data-level="" data-path="segmentizing.html"><a href="segmentizing.html#by-day"><i class="fa fa-check"></i>By day</a></li>
<li class="chapter" data-level="" data-path="segmentizing.html"><a href="segmentizing.html#by-target-length-of-100-km"><i class="fa fa-check"></i>By target length of 100 km</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="segmentizing.html"><a href="segmentizing.html#contiguous-vs.-non-contiguous-effort"><i class="fa fa-check"></i>Contiguous vs. non-contiguous effort</a></li>
<li class="chapter" data-level="" data-path="segmentizing.html"><a href="segmentizing.html#segment-remainder-handling"><i class="fa fa-check"></i>Segment remainder handling</a>
<ul>
<li class="chapter" data-level="" data-path="segmentizing.html"><a href="segmentizing.html#append"><i class="fa fa-check"></i><code>"append"</code></a></li>
<li class="chapter" data-level="" data-path="segmentizing.html"><a href="segmentizing.html#segment"><i class="fa fa-check"></i><code>"segment"</code></a></li>
<li class="chapter" data-level="" data-path="segmentizing.html"><a href="segmentizing.html#disperse"><i class="fa fa-check"></i><code>"disperse"</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="segmentizing.html"><a href="segmentizing.html#typical-settings"><i class="fa fa-check"></i>Typical settings</a>
<ul>
<li class="chapter" data-level="" data-path="segmentizing.html"><a href="segmentizing.html#design-based-line-transect-analysis"><i class="fa fa-check"></i>Design-based line transect analysis</a></li>
<li class="chapter" data-level="" data-path="segmentizing.html"><a href="segmentizing.html#habitat-modeling"><i class="fa fa-check"></i>Habitat modeling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="validation.html"><a href="validation.html"><i class="fa fa-check"></i><b>19</b> Validation</a>
<ul>
<li class="chapter" data-level="" data-path="validation.html"><a href="validation.html#data-processing-1"><i class="fa fa-check"></i>Data processing</a>
<ul>
<li class="chapter" data-level="" data-path="validation.html"><a href="validation.html#sightings"><i class="fa fa-check"></i>Sightings</a></li>
<li class="chapter" data-level="" data-path="validation.html"><a href="validation.html#group-sizes"><i class="fa fa-check"></i>Group sizes</a></li>
<li class="chapter" data-level="" data-path="validation.html"><a href="validation.html#effort"><i class="fa fa-check"></i>Effort</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="spp_codes.html"><a href="spp_codes.html"><i class="fa fa-check"></i><b>20</b> NOAA/NMFS species codes</a>
<ul>
<li class="chapter" data-level="" data-path="spp_codes.html"><a href="spp_codes.html#table"><i class="fa fa-check"></i>Table</a></li>
<li class="chapter" data-level="" data-path="spp_codes.html"><a href="spp_codes.html#species_translator"><i class="fa fa-check"></i><code>species_translator()</code></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">User’s guide for <code>LTabundR</code></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="subgroups2" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">11</span> Subgroup-based analysis<a href="subgroups2.html#subgroups2" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>False killer whales (<em>Pseudorca crassidens</em>) are rare and occur in dispersed subgroups, which complicates conventional distance sampling approaches to line-transect analysis (<a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0090464">Bradford et al. 2014</a>). To better estimate their abundance in Hawaiian waters, the Pacific Islands Fisheries Science Center initiated a sub-group protocol referred to as the “PC Protocol”, a reference to the species’ scientific name. Data collected using the PC Protocol is then analyzed using a subgroup-based analytical approach (<a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0090464">Bradford et al. 2014</a>, <a href="https://repository.library.noaa.gov/view/noaa/24756">2020</a>).</p>
<p>An additional complication is that false killer whales in Hawaiian waters belong to three discrete populations – the Main Hawaiian Islands insular population, the Northwestern Hawaiian Islands (NWHI) population, and a pelagic population – whose ranges partially overlap, which means that population assignment cannot always be based simply on the geographic location of sightings. When geographic assignment of population is not possible, biopsy-sampled genetics or photo-identification inference, if available, is used to assign each sighting to a population <em>post-hoc</em>.</p>
<p>To accommodate these special circumstances for false killer whales (and potentially other species with subgroup structure) with an appropriate balance of flexibility and efficiency, <code>LTabundR</code> includes a function named <code>lta_subgroup()</code>, whose use looks something like this:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="subgroups2.html#cb202-1" tabindex="-1"></a><span class="fu">lta_subgroup</span>(df_sits,</span>
<span id="cb202-2"><a href="subgroups2.html#cb202-2" tabindex="-1"></a>             truncation_distance,</span>
<span id="cb202-3"><a href="subgroups2.html#cb202-3" tabindex="-1"></a>             ss,</span>
<span id="cb202-4"><a href="subgroups2.html#cb202-4" tabindex="-1"></a>             density_segments,</span>
<span id="cb202-5"><a href="subgroups2.html#cb202-5" tabindex="-1"></a>             density_das,</span>
<span id="cb202-6"><a href="subgroups2.html#cb202-6" tabindex="-1"></a>             density_sightings,</span>
<span id="cb202-7"><a href="subgroups2.html#cb202-7" tabindex="-1"></a>             <span class="at">Rg0=</span> <span class="cn">NULL</span>, </span>
<span id="cb202-8"><a href="subgroups2.html#cb202-8" tabindex="-1"></a>             <span class="at">cruz10 =</span> <span class="cn">NULL</span>,</span>
<span id="cb202-9"><a href="subgroups2.html#cb202-9" tabindex="-1"></a>             <span class="at">g0_spp =</span> <span class="cn">NULL</span>,</span>
<span id="cb202-10"><a href="subgroups2.html#cb202-10" tabindex="-1"></a>             <span class="at">g0_truncation =</span> <span class="cn">NULL</span>,</span>
<span id="cb202-11"><a href="subgroups2.html#cb202-11" tabindex="-1"></a>             <span class="at">g0_constrain_shape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb202-12"><a href="subgroups2.html#cb202-12" tabindex="-1"></a>             <span class="at">g0_jackknife_fraction =</span> <span class="fl">0.1</span>,</span>
<span id="cb202-13"><a href="subgroups2.html#cb202-13" tabindex="-1"></a>             <span class="at">abundance_area =</span> <span class="cn">NULL</span>,</span>
<span id="cb202-14"><a href="subgroups2.html#cb202-14" tabindex="-1"></a>             <span class="at">iterations =</span> <span class="dv">5000</span>,</span>
<span id="cb202-15"><a href="subgroups2.html#cb202-15" tabindex="-1"></a>             <span class="at">density_bootstraps =</span> <span class="dv">10000</span>,</span>
<span id="cb202-16"><a href="subgroups2.html#cb202-16" tabindex="-1"></a>             <span class="at">output_dir =</span> <span class="cn">NULL</span>,</span>
<span id="cb202-17"><a href="subgroups2.html#cb202-17" tabindex="-1"></a>             <span class="at">toplot =</span> <span class="cn">TRUE</span>,</span>
<span id="cb202-18"><a href="subgroups2.html#cb202-18" tabindex="-1"></a>             <span class="at">verbose =</span> <span class="cn">TRUE</span></span></code></pre></div>
<p>Note that there are several required inputs (without any defaults) as well as many optional inputs (with defaults provided).</p>
<p>We will step through each of these inputs below, using a case study in which we estimate the abundance of the pelagic false killer whale population in the Hawaiian EEZ for 2017 (<a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. 2020</a>).</p>
<p>Before proceeding, we recommend that you review the details of <a href="processing.html#subgroups">how subgroup data are processed</a> within the <code>LTabundR</code> framework.</p>
<div id="manual-data-updates" class="section level2 unnumbered hasAnchor">
<h2>Manual data updates<a href="subgroups2.html#manual-data-updates" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>LTabundR</code> has been designed to make a first-pass attempt at processing subgroup data resulting from the PC protocol. In most cases the processed subgroup data will need to be reviewed carefully and it is probable that some manual edits will be necessary. To facilitate that process, <code>LTabundR</code> offers functions that allow the user to review the processed data, stage reproducible edits using code, and re-process the data to apply those edits.</p>
<p>In short, here are the functions related to each step in this editing workflow:</p>
<ol style="list-style-type: decimal">
<li><p>To review the default processing applied to the subgroup data when you ran <code>process_surveys()</code>, use the function <strong><code>subgroup_explorer()</code></strong>.</p></li>
<li><p>To edit the way subgroup data are processed – e.g., assigning detections to certain populations or changing the phase of the PC protocol for a detection – use the functions <strong><code>subgroup_populations()</code></strong> and <strong><code>subgroup_edits()</code></strong>. Collect the outputs of those functions into a <code>list</code>, then …</p></li>
<li><p>To re-process the subgroup data with your <code>list</code> of staged edits, run <strong><code>process_subgroups()</code></strong> and pass your <code>list</code> to the input named <code>edits</code>.</p></li>
</ol>
<p>We provide details for each of those steps in the following subsections.</p>
<div id="reviewing-processed-subgroup-data" class="section level3 unnumbered hasAnchor">
<h3>Reviewing processed subgroup data<a href="subgroups2.html#reviewing-processed-subgroup-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For reviewing processed subgroup data, use the <strong><code>subgroup_explorer()</code></strong> function.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="subgroups2.html#cb203-1" tabindex="-1"></a><span class="fu">subgroup_explorer</span>(cruz, <span class="at">cohort=</span><span class="st">&#39;pseudorca&#39;</span>)</span></code></pre></div>
<p>This function launches an interactive <code>Shiny</code> dashboard for exploring the processed subgroups <code>events</code>. It will look like this:</p>
<p><img src="img/subgroup_explorer.png" style="width:95.0%" /></p>
<p>To stage code for reproducible edits to the processed data, two functions are available: <code>subgroup_populations()</code> and <code>subgroup_edits()</code>. We review those functions below, then show how to apply those coded edits by re-processing the subgroup data.</p>
</div>
<div id="staging-subgroup-edits" class="section level3 unnumbered hasAnchor">
<h3>Staging subgroup edits<a href="subgroups2.html#staging-subgroup-edits" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="subgroup_populations" class="section level4 unnumbered hasAnchor">
<h4><code>subgroup_populations()</code><a href="subgroups2.html#subgroup_populations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The function <code>subgroup_populations()</code> allows you to batch-assign subgroup events to certain populations based upon spatial polygons. Its use looks like this:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="subgroups2.html#cb204-1" tabindex="-1"></a><span class="fu">subgroup_populations</span>(populations,</span>
<span id="cb204-2"><a href="subgroups2.html#cb204-2" tabindex="-1"></a>                     cruz,</span>
<span id="cb204-3"><a href="subgroups2.html#cb204-3" tabindex="-1"></a>                     <span class="at">cohort=</span><span class="st">&#39;pseudorca&#39;</span>,</span>
<span id="cb204-4"><a href="subgroups2.html#cb204-4" tabindex="-1"></a>                     <span class="at">default_pop =</span> <span class="st">&#39;pelagic&#39;</span>)</span></code></pre></div>
<p>When you run this function, it returns a <code>data.frame</code> of instructions in which each row is a population assignment for a subgroup event:</p>
<pre><code>        edit    cohort            sgid population pop_prob
1 population pseudorca  20111026-004-A    pelagic        1
2 population pseudorca  20111026-004-B    pelagic        1
3 population pseudorca  20111026-004-C    pelagic        1
4 population pseudorca  20111026-004-D    pelagic        1
5 population pseudorca  20111026-004-D    pelagic        1
6 population pseudorca 20111026-004-SA    pelagic        1</code></pre>
<p>This <code>data.frame</code> is formatted exactly as needed to pass these edits to the re-processing routine <code>process_subgroups()</code>. The column <code>population</code> contains the population assignment, and <code>pop_prob</code> contains the probility that the event is assigned to this population. The latter will be <code>1.0</code> unless the event occurs in overlapping polygons, in which case the <code>population</code> column will display all eligible population names separated by a semicolon (e.g., if there are two overlapping polygons named <code>"MHI"</code> and <code>"NWHI"</code>, the <code>population</code> will be shown as <code>"MHI;NWHI"</code>), and the <code>pop_prob</code> column will display an equal probability of assignment for each of those populations (e.g., <code>"0.5;0.5"</code>). If an event does not occur within any of the polygons provided, it will be given the <code>default_pop</code> name, with a default <code>pop_prob</code> of <code>1.0</code>.</p>
<p>In the <code>subgroup_populations()</code> function, the <code>populations</code> input is a named list of polygon coordinates, very similar to the way <code>strata</code> are supplied in the settings for <code>process_surveys()</code>. Here’s an example of what that list could look like if you chose to use some of the strata in your <code>cruz</code> <code>settings</code>:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="subgroups2.html#cb206-1" tabindex="-1"></a><span class="co"># Pull polygons from settings</span></span>
<span id="cb206-2"><a href="subgroups2.html#cb206-2" tabindex="-1"></a>mhi <span class="ot">&lt;-</span> cruz<span class="sc">$</span>settings<span class="sc">$</span>strata<span class="sc">$</span>MHI</span>
<span id="cb206-3"><a href="subgroups2.html#cb206-3" tabindex="-1"></a>nwhi <span class="ot">&lt;-</span> cruz<span class="sc">$</span>settings<span class="sc">$</span>strata<span class="sc">$</span>NWHI</span>
<span id="cb206-4"><a href="subgroups2.html#cb206-4" tabindex="-1"></a></span>
<span id="cb206-5"><a href="subgroups2.html#cb206-5" tabindex="-1"></a><span class="co"># Example of data structure</span></span>
<span id="cb206-6"><a href="subgroups2.html#cb206-6" tabindex="-1"></a>mhi <span class="sc">%&gt;%</span> head </span>
<span id="cb206-7"><a href="subgroups2.html#cb206-7" tabindex="-1"></a>      Lon   Lat</span>
<span id="cb206-8"><a href="subgroups2.html#cb206-8" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span><span class="fl">156.00</span> <span class="fl">22.00</span></span>
<span id="cb206-9"><a href="subgroups2.html#cb206-9" tabindex="-1"></a><span class="dv">2</span> <span class="sc">-</span><span class="fl">154.40</span> <span class="fl">20.60</span></span>
<span id="cb206-10"><a href="subgroups2.html#cb206-10" tabindex="-1"></a><span class="dv">3</span> <span class="sc">-</span><span class="fl">153.50</span> <span class="fl">19.20</span></span>
<span id="cb206-11"><a href="subgroups2.html#cb206-11" tabindex="-1"></a><span class="dv">4</span> <span class="sc">-</span><span class="fl">154.35</span> <span class="fl">18.55</span></span>
<span id="cb206-12"><a href="subgroups2.html#cb206-12" tabindex="-1"></a><span class="dv">5</span> <span class="sc">-</span><span class="fl">155.20</span> <span class="fl">17.75</span></span>
<span id="cb206-13"><a href="subgroups2.html#cb206-13" tabindex="-1"></a><span class="dv">6</span> <span class="sc">-</span><span class="fl">157.00</span> <span class="fl">18.25</span></span>
<span id="cb206-14"><a href="subgroups2.html#cb206-14" tabindex="-1"></a></span>
<span id="cb206-15"><a href="subgroups2.html#cb206-15" tabindex="-1"></a><span class="co"># Create populations object</span></span>
<span id="cb206-16"><a href="subgroups2.html#cb206-16" tabindex="-1"></a>populations <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">MHI =</span> mhi,</span>
<span id="cb206-17"><a href="subgroups2.html#cb206-17" tabindex="-1"></a>                    <span class="at">NWHI =</span> nwhi)</span></code></pre></div>
<p>The name of each list slot will be treated as the name of the population occurring within the respective polygon. When we used these polygons as the population boundaries, we get the following variety of population assignments and probabilities:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="subgroups2.html#cb207-1" tabindex="-1"></a>pops <span class="ot">&lt;-</span> </span>
<span id="cb207-2"><a href="subgroups2.html#cb207-2" tabindex="-1"></a>  <span class="fu">subgroup_populations</span>(populations, </span>
<span id="cb207-3"><a href="subgroups2.html#cb207-3" tabindex="-1"></a>                       cruz, </span>
<span id="cb207-4"><a href="subgroups2.html#cb207-4" tabindex="-1"></a>                       <span class="at">cohort =</span> <span class="st">&#39;pseudorca&#39;</span>, </span>
<span id="cb207-5"><a href="subgroups2.html#cb207-5" tabindex="-1"></a>                       <span class="at">default_pop =</span> <span class="st">&#39;pelagic&#39;</span>)</span>
<span id="cb207-6"><a href="subgroups2.html#cb207-6" tabindex="-1"></a></span>
<span id="cb207-7"><a href="subgroups2.html#cb207-7" tabindex="-1"></a>pops<span class="sc">$</span>population <span class="sc">%&gt;%</span> table</span>
<span id="cb207-8"><a href="subgroups2.html#cb207-8" tabindex="-1"></a>.</span>
<span id="cb207-9"><a href="subgroups2.html#cb207-9" tabindex="-1"></a>     MHI MHI;NWHI     NWHI  pelagic </span>
<span id="cb207-10"><a href="subgroups2.html#cb207-10" tabindex="-1"></a>      <span class="dv">92</span>       <span class="dv">47</span>       <span class="dv">61</span>      <span class="dv">109</span> </span>
<span id="cb207-11"><a href="subgroups2.html#cb207-11" tabindex="-1"></a></span>
<span id="cb207-12"><a href="subgroups2.html#cb207-12" tabindex="-1"></a>pops<span class="sc">$</span>pop_prob <span class="sc">%&gt;%</span> table</span>
<span id="cb207-13"><a href="subgroups2.html#cb207-13" tabindex="-1"></a>.</span>
<span id="cb207-14"><a href="subgroups2.html#cb207-14" tabindex="-1"></a><span class="fl">0.5</span>;<span class="fl">0.5</span>       <span class="dv">1</span> </span>
<span id="cb207-15"><a href="subgroups2.html#cb207-15" tabindex="-1"></a>     <span class="dv">47</span>     <span class="dv">262</span> </span></code></pre></div>
</div>
<div id="stage-specific-edits" class="section level4 unnumbered hasAnchor">
<h4>Stage specific edits<a href="subgroups2.html#stage-specific-edits" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To manually stage specific edits to the processed subgroup data, use the <code>subgroup_edits()</code> function. Its use will look something like this, though the latter inputs depend on the type of edit you are staging:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="subgroups2.html#cb208-1" tabindex="-1"></a><span class="fu">subgroup_edits</span>(<span class="at">cohort =</span> <span class="st">&#39;pseudorca&#39;</span>,</span>
<span id="cb208-2"><a href="subgroups2.html#cb208-2" tabindex="-1"></a>               <span class="at">sgid =</span> <span class="st">&#39;1108-20111026-004-A&#39;</span>,</span>
<span id="cb208-3"><a href="subgroups2.html#cb208-3" tabindex="-1"></a>               ...) <span class="co"># remaining inputs depend on the type of edit</span></span></code></pre></div>
<p>The input <code>sgid</code> refers to the unique subgroup ID assigned, which you can find when you look at the subgroup data with <code>subgroup_explorer()</code> (described above). You can supply a single <code>sgid</code> or a vector of <code>sgid</code>’s.</p>
<p>This <code>subgroup_edits()</code> function returns a <code>list</code> of staged edits that can be passed directly to the subgroup re-processing routine we explain further below.</p>
<div id="edit-population" class="section level5 unnumbered hasAnchor">
<h5>Edit population<a href="subgroups2.html#edit-population" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>If you need to fix population assignments on a case-by-case basis after using the batch-assignment function, <code>subgroup_populations()</code> discussed above, use the following syntax:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="subgroups2.html#cb209-1" tabindex="-1"></a><span class="fu">subgroup_edits</span>(<span class="at">cohort =</span> <span class="st">&#39;pseudorca&#39;</span>,</span>
<span id="cb209-2"><a href="subgroups2.html#cb209-2" tabindex="-1"></a>               <span class="at">sgid =</span> <span class="st">&#39;1108-20111026-004-A&#39;</span>,</span>
<span id="cb209-3"><a href="subgroups2.html#cb209-3" tabindex="-1"></a>               <span class="at">population =</span> <span class="st">&#39;MHI;NWHI&#39;</span>,</span>
<span id="cb209-4"><a href="subgroups2.html#cb209-4" tabindex="-1"></a>               <span class="at">pop_prob =</span> <span class="st">&#39;0.5;0.5&#39;</span>)</span></code></pre></div>
<p>The <code>population</code> input takes a character vector, with length of either 1 or the same as <code>sgid</code>, indicating the new population(s) to assign the <code>sgid</code>(s). If you want a <code>sgid</code> to be eligible for multiple populations, separate the population names with a semicolon. Both this input and <code>pop_prob</code> needs to not provided in order for the edit to work properly.</p>
<p>The <code>pop_prob</code> input takes a vector, with length of either 1 or the same as <code>sgid</code>
and values ranging between 0 and 1, indicating the probability of each population assignment for the <code>sgid</code>’s. If you want a <code>sgid</code> to be eligible for multiple populations, provide a character vector and separate the probabilities by a semicolon, e.g., <code>"0.5;0.5"</code>. Both this input and <code>population</code> needs to not be provided in order for the edit to work properly.</p>
</div>
<div id="edit-phases" class="section level5 unnumbered hasAnchor">
<h5>Edit phases<a href="subgroups2.html#edit-phases" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>If you need to fix the phase assignment for subgroup event(s), use the following syntax:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="subgroups2.html#cb210-1" tabindex="-1"></a><span class="fu">subgroup_edits</span>(<span class="at">cohort =</span> <span class="st">&#39;pseudorca&#39;</span>,</span>
<span id="cb210-2"><a href="subgroups2.html#cb210-2" tabindex="-1"></a>               <span class="at">sgid =</span> <span class="st">&#39;1108-20111026-004-A&#39;</span>,</span>
<span id="cb210-3"><a href="subgroups2.html#cb210-3" tabindex="-1"></a>               <span class="at">phase =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>The input <code>phase</code> takes a numeric vector, with length of either 1 or the same as <code>sgid</code>, indicating the new phase to assign the <code>sgid</code>(s). If you wish to remove a phase assignment for a <code>sgid</code>, use <code>NA</code>.</p>
</div>
<div id="edit-primary-observer" class="section level5 unnumbered hasAnchor">
<h5>Edit primary observer<a href="subgroups2.html#edit-primary-observer" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>If you want to control whether a subgroup event was seen by the primary/standard observer (the column <code>ObsStd</code> is either <code>TRUE</code> or <code>FALSE</code>), use the following syntax:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="subgroups2.html#cb211-1" tabindex="-1"></a><span class="fu">subgroup_edits</span>(<span class="at">cohort =</span> <span class="st">&#39;pseudorca&#39;</span>,</span>
<span id="cb211-2"><a href="subgroups2.html#cb211-2" tabindex="-1"></a>               <span class="at">sgid =</span> <span class="st">&#39;1108-20111026-004-A&#39;</span>,</span>
<span id="cb211-3"><a href="subgroups2.html#cb211-3" tabindex="-1"></a>               <span class="at">ObsStd =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The input <code>ObsStd</code> takes a Boolean vector, with length of either 1 or the same as <code>sgid</code>, indicating the value for <code>ObsStd</code> for each <code>sgid</code>.</p>
</div>
<div id="removeexclude-subgroup" class="section level5 unnumbered hasAnchor">
<h5>Remove/exclude subgroup<a href="subgroups2.html#removeexclude-subgroup" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>In rare cases you may need to delete a subgroup so that it does not affect any aspect of the analysis. To do so, use this syntax:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="subgroups2.html#cb212-1" tabindex="-1"></a><span class="fu">subgroup_edits</span>(<span class="at">cohort =</span> <span class="st">&#39;pseudorca&#39;</span>,</span>
<span id="cb212-2"><a href="subgroups2.html#cb212-2" tabindex="-1"></a>               <span class="at">sgid =</span> <span class="st">&#39;1108-20111026-004-A&#39;</span>,</span>
<span id="cb212-3"><a href="subgroups2.html#cb212-3" tabindex="-1"></a>               <span class="at">exclude =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The input <code>exclude</code> takes a Boolean vector, with length of either 1 or the same as <code>sgid</code>, indicating which <code>sgid</code>’s to erase: <code>TRUE</code> means exclude, <code>FALSE</code> means keep. We recommend implementing these edits last, since the removal of a row of data may possible have downstream effects on how other edits are applied.</p>
</div>
</div>
<div id="re-processing-subgroup-data" class="section level4 unnumbered hasAnchor">
<h4>Re-processing subgroup data<a href="subgroups2.html#re-processing-subgroup-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Here is an arbitrary example of how a set of staged edits may look in your code:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="subgroups2.html#cb213-1" tabindex="-1"></a><span class="co"># Batch-edit population assignments ========</span></span>
<span id="cb213-2"><a href="subgroups2.html#cb213-2" tabindex="-1"></a>mhi <span class="ot">&lt;-</span> cruz<span class="sc">$</span>settings<span class="sc">$</span>strata<span class="sc">$</span>MHI</span>
<span id="cb213-3"><a href="subgroups2.html#cb213-3" tabindex="-1"></a>nwhi <span class="ot">&lt;-</span> cruz<span class="sc">$</span>settings<span class="sc">$</span>strata<span class="sc">$</span>NWHI</span>
<span id="cb213-4"><a href="subgroups2.html#cb213-4" tabindex="-1"></a>new_pops <span class="ot">&lt;-</span> <span class="fu">subgroup_populations</span>(<span class="at">populations =</span> <span class="fu">list</span>(<span class="at">MHI =</span> mhi, <span class="at">NWHI =</span> nwhi), </span>
<span id="cb213-5"><a href="subgroups2.html#cb213-5" tabindex="-1"></a>                                 cruz, </span>
<span id="cb213-6"><a href="subgroups2.html#cb213-6" tabindex="-1"></a>                                 <span class="at">cohort =</span> <span class="st">&#39;pseudorca&#39;</span>, </span>
<span id="cb213-7"><a href="subgroups2.html#cb213-7" tabindex="-1"></a>                                 <span class="at">default_pop =</span> <span class="st">&#39;pelagic&#39;</span>)</span>
<span id="cb213-8"><a href="subgroups2.html#cb213-8" tabindex="-1"></a></span>
<span id="cb213-9"><a href="subgroups2.html#cb213-9" tabindex="-1"></a><span class="co"># Case-by-case edits =======================</span></span>
<span id="cb213-10"><a href="subgroups2.html#cb213-10" tabindex="-1"></a></span>
<span id="cb213-11"><a href="subgroups2.html#cb213-11" tabindex="-1"></a><span class="co"># Population changes</span></span>
<span id="cb213-12"><a href="subgroups2.html#cb213-12" tabindex="-1"></a>edit1 <span class="ot">&lt;-</span> <span class="fu">subgroup_edits</span>(<span class="at">cohort=</span>cohort, </span>
<span id="cb213-13"><a href="subgroups2.html#cb213-13" tabindex="-1"></a>                        <span class="at">sgid =</span> <span class="st">&#39;1108-20111026-004-A&#39;</span>,</span>
<span id="cb213-14"><a href="subgroups2.html#cb213-14" tabindex="-1"></a>                        <span class="at">population =</span> <span class="st">&#39;space whales&#39;</span>, </span>
<span id="cb213-15"><a href="subgroups2.html#cb213-15" tabindex="-1"></a>                        <span class="at">pop_prob =</span> <span class="st">&#39;1&#39;</span>)</span>
<span id="cb213-16"><a href="subgroups2.html#cb213-16" tabindex="-1"></a></span>
<span id="cb213-17"><a href="subgroups2.html#cb213-17" tabindex="-1"></a><span class="co"># Phase changes</span></span>
<span id="cb213-18"><a href="subgroups2.html#cb213-18" tabindex="-1"></a>edit2 <span class="ot">&lt;-</span> <span class="fu">subgroup_edits</span>(<span class="at">cohort=</span>cohort, </span>
<span id="cb213-19"><a href="subgroups2.html#cb213-19" tabindex="-1"></a>                        <span class="at">sgid =</span> <span class="st">&#39;1108-20111026-004-D&#39;</span>,</span>
<span id="cb213-20"><a href="subgroups2.html#cb213-20" tabindex="-1"></a>                        <span class="at">phase =</span> <span class="dv">2</span>)</span>
<span id="cb213-21"><a href="subgroups2.html#cb213-21" tabindex="-1"></a></span>
<span id="cb213-22"><a href="subgroups2.html#cb213-22" tabindex="-1"></a><span class="co"># Multiple changes to same sgid</span></span>
<span id="cb213-23"><a href="subgroups2.html#cb213-23" tabindex="-1"></a>edit3 <span class="ot">&lt;-</span> <span class="fu">subgroup_edits</span>(<span class="at">cohort=</span>cohort, </span>
<span id="cb213-24"><a href="subgroups2.html#cb213-24" tabindex="-1"></a>                        <span class="at">sgid =</span> <span class="st">&#39;1108-20111026-004-C&#39;</span>,</span>
<span id="cb213-25"><a href="subgroups2.html#cb213-25" tabindex="-1"></a>                        <span class="at">phase=</span><span class="dv">2</span>,</span>
<span id="cb213-26"><a href="subgroups2.html#cb213-26" tabindex="-1"></a>                        <span class="at">population =</span> <span class="st">&#39;space whales&#39;</span>, </span>
<span id="cb213-27"><a href="subgroups2.html#cb213-27" tabindex="-1"></a>                        <span class="at">pop_prob =</span> <span class="st">&#39;1&#39;</span>),</span>
<span id="cb213-28"><a href="subgroups2.html#cb213-28" tabindex="-1"></a><span class="co"># Exclusion</span></span>
<span id="cb213-29"><a href="subgroups2.html#cb213-29" tabindex="-1"></a>edit4 <span class="ot">&lt;-</span> <span class="fu">subgroup_edits</span>(<span class="at">cohort=</span>cohort, </span>
<span id="cb213-30"><a href="subgroups2.html#cb213-30" tabindex="-1"></a>                        <span class="at">sgid =</span> <span class="st">&#39;1108-20111026-004-D&#39;</span>,</span>
<span id="cb213-31"><a href="subgroups2.html#cb213-31" tabindex="-1"></a>                        <span class="at">exclude =</span> <span class="cn">TRUE</span>)<span class="er">)</span></span></code></pre></div>
<p>Now that you have these edits staged, you can put them into a <code>list</code>and re-process your subgroup data using the function <code>process_subgroups()</code>:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="subgroups2.html#cb214-1" tabindex="-1"></a>edits <span class="ot">&lt;-</span> <span class="fu">list</span>(new_pops, edit1, edit2, edit3, edit4)</span>
<span id="cb214-2"><a href="subgroups2.html#cb214-2" tabindex="-1"></a></span>
<span id="cb214-3"><a href="subgroups2.html#cb214-3" tabindex="-1"></a>cruz_revised <span class="ot">&lt;-</span> <span class="fu">process_subgroups</span>(cruz, <span class="at">edits =</span> edits)</span></code></pre></div>
<p>You can use the <code>subgroup_explorer()</code> function to verify that changes were applied as intended.</p>
<p>We will use most of these functions in the code below that prepares inputs for the <code>lta_subgroups()</code> function to replicate the 2017 estimates for <a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. (2020)</a>.</p>
</div>
</div>
</div>
<div id="inputs-to-lta_subgroup" class="section level2 unnumbered hasAnchor">
<h2>Inputs to <code>lta_subgroup()</code><a href="subgroups2.html#inputs-to-lta_subgroup" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="df_sits" class="section level3 unnumbered hasAnchor">
<h3><code>df_sits</code><a href="subgroups2.html#df_sits" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is a <code>data.frame</code> of sightings you want to use to fit the detection function model. For false killer whales in <a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. (2020)</a>, this is a combination of filtered sightings prior to 2011 (made without the PC protocol) and “Phase 1” sightings from 2011 onwards (using the PC protocol). No filtering will be applied to these sightings within this function, so make sure you provide the data pre-filtered. <a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. (2020)</a> used a single detection function for all populations of false killer whales.</p>
<p><code>LTabundR</code> has a built-in dataset of processed surveys from all NOAA cruises in the Pacific, 1986-2020. We will use that here as a starting point:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="subgroups2.html#cb215-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;noaa_10km_1986_2020&quot;</span>)</span>
<span id="cb215-2"><a href="subgroups2.html#cb215-2" tabindex="-1"></a>cruz <span class="ot">&lt;-</span> noaa_10km_1986_2020</span></code></pre></div>
<p>The code used to generate this dataset can be seen by pulling up the help documentation: <code>?noaa_10km_1986_2020</code>.</p>
<p>This dataset was not processed with subgroups in mind, but we can easily add the default subgroup processing to the <code>cruz</code> object using the function <code>process_subgroups()</code> (without supplying edits this first time round):</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="subgroups2.html#cb216-1" tabindex="-1"></a>cruz <span class="ot">&lt;-</span> <span class="fu">process_subgroups</span>(cruz)</span></code></pre></div>
<p>Now that the subgroup data are processed, they need to be filtered for use in the detection function model. On-Effort sightings from 1986-2010 were eligible for use, specifically: <code>OnEffort</code> is <code>TRUE</code>, <code>EffType</code> can be <code>"S"</code>, <code>"F"</code>, or <code>"N"</code>; no mixed-species schools; no sightings past beam; and only detections made by a primary observer.</p>
<p>Here we draw those sightings from the above <code>cruz</code> object, filtering as needed, and to simplify we will select only a few key columns.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="subgroups2.html#cb217-1" tabindex="-1"></a>sits1  <span class="ot">&lt;-</span></span>
<span id="cb217-2"><a href="subgroups2.html#cb217-2" tabindex="-1"></a>  cruz<span class="sc">$</span>cohorts<span class="sc">$</span>all<span class="sc">$</span>sightings <span class="sc">%&gt;%</span></span>
<span id="cb217-3"><a href="subgroups2.html#cb217-3" tabindex="-1"></a>  <span class="fu">filter</span>(OnEffort <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb217-4"><a href="subgroups2.html#cb217-4" tabindex="-1"></a>         year <span class="sc">&gt;=</span> <span class="dv">1986</span>,</span>
<span id="cb217-5"><a href="subgroups2.html#cb217-5" tabindex="-1"></a>         year <span class="sc">&lt;=</span> <span class="dv">2010</span>,</span>
<span id="cb217-6"><a href="subgroups2.html#cb217-6" tabindex="-1"></a>         OnEffort <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb217-7"><a href="subgroups2.html#cb217-7" tabindex="-1"></a>         EffType <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;S&#39;</span>, <span class="st">&#39;F&#39;</span>, <span class="st">&#39;N&#39;</span>), </span>
<span id="cb217-8"><a href="subgroups2.html#cb217-8" tabindex="-1"></a>         species <span class="sc">==</span> <span class="st">&#39;033&#39;</span>, <span class="co"># code for false killer whales</span></span>
<span id="cb217-9"><a href="subgroups2.html#cb217-9" tabindex="-1"></a>         ObsStd <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb217-10"><a href="subgroups2.html#cb217-10" tabindex="-1"></a>         mixed <span class="sc">==</span> <span class="cn">FALSE</span>,</span>
<span id="cb217-11"><a href="subgroups2.html#cb217-11" tabindex="-1"></a>         Bearing <span class="sc">&lt;=</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span></span>
<span id="cb217-12"><a href="subgroups2.html#cb217-12" tabindex="-1"></a>  <span class="fu">select</span>(DateTime, Lat, Lon, Cruise, PerpDistKm) <span class="sc">%&gt;%</span> </span>
<span id="cb217-13"><a href="subgroups2.html#cb217-13" tabindex="-1"></a>  <span class="fu">arrange</span>(DateTime)</span>
<span id="cb217-14"><a href="subgroups2.html#cb217-14" tabindex="-1"></a></span>
<span id="cb217-15"><a href="subgroups2.html#cb217-15" tabindex="-1"></a>sits1 <span class="sc">%&gt;%</span> nrow</span>
<span id="cb217-16"><a href="subgroups2.html#cb217-16" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">40</span></span>
<span id="cb217-17"><a href="subgroups2.html#cb217-17" tabindex="-1"></a></span>
<span id="cb217-18"><a href="subgroups2.html#cb217-18" tabindex="-1"></a>sits1 <span class="sc">%&gt;%</span> head</span>
<span id="cb217-19"><a href="subgroups2.html#cb217-19" tabindex="-1"></a>                       DateTime        Lat        Lon Cruise PerpDistKm</span>
<span id="cb217-20"><a href="subgroups2.html#cb217-20" tabindex="-1"></a>SpPerc1268  <span class="dv">1986-09-17</span> <span class="dv">16</span><span class="sc">:</span><span class="dv">50</span><span class="sc">:</span><span class="dv">00</span> <span class="sc">-</span><span class="fl">3.3833333</span> <span class="sc">-</span><span class="fl">107.76667</span>    <span class="dv">989</span>  <span class="fl">0.0782689</span></span>
<span id="cb217-21"><a href="subgroups2.html#cb217-21" tabindex="-1"></a>SpPerc11076 <span class="dv">1986-11-13</span> <span class="dv">09</span><span class="sc">:</span><span class="dv">43</span><span class="sc">:</span><span class="dv">00</span> <span class="fl">10.4666667</span> <span class="sc">-</span><span class="fl">139.28333</span>    <span class="dv">990</span>  <span class="fl">1.1749374</span></span>
<span id="cb217-22"><a href="subgroups2.html#cb217-22" tabindex="-1"></a>SpPerc1689  <span class="dv">1986-11-16</span> <span class="dv">17</span><span class="sc">:</span><span class="dv">09</span><span class="sc">:</span><span class="dv">00</span>  <span class="fl">0.4333333</span>  <span class="sc">-</span><span class="fl">92.06667</span>    <span class="dv">989</span>  <span class="fl">5.6311156</span></span>
<span id="cb217-23"><a href="subgroups2.html#cb217-23" tabindex="-1"></a>SpPerc11299 <span class="dv">1987-09-15</span> <span class="dv">17</span><span class="sc">:</span><span class="dv">25</span><span class="sc">:</span><span class="dv">00</span>  <span class="fl">3.6000000</span> <span class="sc">-</span><span class="fl">119.85000</span>   <span class="dv">1080</span>  <span class="fl">0.2348067</span></span>
<span id="cb217-24"><a href="subgroups2.html#cb217-24" tabindex="-1"></a>SpPerc11314 <span class="dv">1987-09-17</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">54</span><span class="sc">:</span><span class="dv">00</span>  <span class="fl">2.6666667</span> <span class="sc">-</span><span class="fl">115.25000</span>   <span class="dv">1080</span>  <span class="fl">0.8158510</span></span>
<span id="cb217-25"><a href="subgroups2.html#cb217-25" tabindex="-1"></a>SpPerc12200 <span class="dv">1987-10-25</span> <span class="dv">13</span><span class="sc">:</span><span class="dv">33</span><span class="sc">:</span><span class="dv">00</span>  <span class="fl">7.2166667</span>  <span class="sc">-</span><span class="fl">97.95000</span>   <span class="dv">1081</span>  <span class="fl">0.2710214</span></span></code></pre></div>
<p>To add to this pool of sightings, we also included Phase 1 subgroup detections from 2011 to 2017 based on the PC protocol. Specific criteria: PC Protocol is <code>Phase 1</code>, <code>OnEffort</code> is <code>TRUE</code>, <code>EffType</code> can be <code>"S"</code>, <code>"F"</code>, or <code>"N"</code>; no mixed-species schools; no sightings past beam; detection made by primary observer.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="subgroups2.html#cb218-1" tabindex="-1"></a>sits2  <span class="ot">&lt;-</span></span>
<span id="cb218-2"><a href="subgroups2.html#cb218-2" tabindex="-1"></a>  cruz<span class="sc">$</span>cohorts<span class="sc">$</span>all<span class="sc">$</span>subgroups<span class="sc">$</span>subgroups <span class="sc">%&gt;%</span></span>
<span id="cb218-3"><a href="subgroups2.html#cb218-3" tabindex="-1"></a>  <span class="fu">filter</span>(OnEffort <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb218-4"><a href="subgroups2.html#cb218-4" tabindex="-1"></a>         lubridate<span class="sc">::</span><span class="fu">year</span>(DateTime) <span class="sc">&gt;=</span> <span class="dv">2011</span>,</span>
<span id="cb218-5"><a href="subgroups2.html#cb218-5" tabindex="-1"></a>         lubridate<span class="sc">::</span><span class="fu">year</span>(DateTime) <span class="sc">&lt;=</span> <span class="dv">2017</span>,</span>
<span id="cb218-6"><a href="subgroups2.html#cb218-6" tabindex="-1"></a>         ObsStd <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb218-7"><a href="subgroups2.html#cb218-7" tabindex="-1"></a>         Angle <span class="sc">&lt;=</span> <span class="dv">90</span>,</span>
<span id="cb218-8"><a href="subgroups2.html#cb218-8" tabindex="-1"></a>         Species <span class="sc">==</span> <span class="st">&#39;033&#39;</span>,</span>
<span id="cb218-9"><a href="subgroups2.html#cb218-9" tabindex="-1"></a>         Phase <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb218-10"><a href="subgroups2.html#cb218-10" tabindex="-1"></a>  <span class="fu">select</span>(DateTime, Lat, Lon, Cruise, <span class="at">PerpDistKm =</span> PerpDist) <span class="sc">%&gt;%</span> </span>
<span id="cb218-11"><a href="subgroups2.html#cb218-11" tabindex="-1"></a>  <span class="fu">arrange</span>(DateTime)</span>
<span id="cb218-12"><a href="subgroups2.html#cb218-12" tabindex="-1"></a></span>
<span id="cb218-13"><a href="subgroups2.html#cb218-13" tabindex="-1"></a>sits2 <span class="sc">%&gt;%</span> nrow</span>
<span id="cb218-14"><a href="subgroups2.html#cb218-14" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">68</span></span>
<span id="cb218-15"><a href="subgroups2.html#cb218-15" tabindex="-1"></a></span>
<span id="cb218-16"><a href="subgroups2.html#cb218-16" tabindex="-1"></a>sits2 <span class="sc">%&gt;%</span> head</span>
<span id="cb218-17"><a href="subgroups2.html#cb218-17" tabindex="-1"></a>             DateTime       Lat       Lon Cruise PerpDistKm</span>
<span id="cb218-18"><a href="subgroups2.html#cb218-18" tabindex="-1"></a><span class="dv">1</span> <span class="dv">2011-10-26</span> <span class="dv">13</span><span class="sc">:</span><span class="dv">16</span><span class="sc">:</span><span class="dv">06</span>  <span class="fl">7.240500</span> <span class="sc">-</span><span class="fl">164.9347</span>   <span class="dv">1108</span>  <span class="fl">1.4714466</span></span>
<span id="cb218-19"><a href="subgroups2.html#cb218-19" tabindex="-1"></a><span class="dv">2</span> <span class="dv">2011-10-26</span> <span class="dv">13</span><span class="sc">:</span><span class="dv">31</span><span class="sc">:</span><span class="dv">17</span>  <span class="fl">7.207333</span> <span class="sc">-</span><span class="fl">164.9572</span>   <span class="dv">1108</span>  <span class="fl">2.1211999</span></span>
<span id="cb218-20"><a href="subgroups2.html#cb218-20" tabindex="-1"></a><span class="dv">3</span> <span class="dv">2011-10-26</span> <span class="dv">13</span><span class="sc">:</span><span class="dv">48</span><span class="sc">:</span><span class="dv">26</span>  <span class="fl">7.169667</span> <span class="sc">-</span><span class="fl">164.9830</span>   <span class="dv">1108</span>  <span class="fl">0.9876483</span></span>
<span id="cb218-21"><a href="subgroups2.html#cb218-21" tabindex="-1"></a><span class="dv">4</span> <span class="dv">2011-10-26</span> <span class="dv">14</span><span class="sc">:</span><span class="dv">02</span><span class="sc">:</span><span class="dv">29</span>  <span class="fl">7.139000</span> <span class="sc">-</span><span class="fl">165.0043</span>   <span class="dv">1108</span>  <span class="fl">1.5731017</span></span>
<span id="cb218-22"><a href="subgroups2.html#cb218-22" tabindex="-1"></a><span class="dv">5</span> <span class="dv">2012-05-13</span> <span class="dv">13</span><span class="sc">:</span><span class="dv">19</span><span class="sc">:</span><span class="dv">44</span> <span class="fl">11.967333</span> <span class="sc">-</span><span class="fl">161.1727</span>   <span class="dv">1203</span>  <span class="fl">0.1851989</span></span>
<span id="cb218-23"><a href="subgroups2.html#cb218-23" tabindex="-1"></a><span class="dv">6</span> <span class="dv">2013-05-13</span> <span class="dv">07</span><span class="sc">:</span><span class="dv">09</span><span class="sc">:</span><span class="dv">54</span> <span class="fl">24.302333</span> <span class="sc">-</span><span class="fl">168.3195</span>   <span class="dv">1303</span>  <span class="fl">1.6787670</span></span></code></pre></div>
<p>To create <code>df_sits</code> for detection function fitting, we combine these datasets together:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="subgroups2.html#cb219-1" tabindex="-1"></a>df_sits <span class="ot">&lt;-</span> <span class="fu">rbind</span>(sits1, sits2)</span>
<span id="cb219-2"><a href="subgroups2.html#cb219-2" tabindex="-1"></a>df_sits <span class="sc">%&gt;%</span> nrow</span>
<span id="cb219-3"><a href="subgroups2.html#cb219-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">108</span></span></code></pre></div>
<p>To check that this sample size matches that used in <a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. 2020</a> (n=100), we can preliminarily filter this set of sightings to those whose perpendicular distance from the trackline is within 4.5 km (see the next section for how this was determined).</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="subgroups2.html#cb220-1" tabindex="-1"></a>df_sits <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PerpDistKm <span class="sc">&lt;=</span> <span class="fl">4.5</span>) <span class="sc">%&gt;%</span> nrow</span>
<span id="cb220-2"><a href="subgroups2.html#cb220-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">100</span></span></code></pre></div>
</div>
<div id="truncation_distance" class="section level3 unnumbered hasAnchor">
<h3><code>truncation_distance</code><a href="subgroups2.html#truncation_distance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The truncation distance, in km, will be applied during detection function model fitting. Typically the farthest 5 - 10% of sightings are truncated, but this needs to be balanced by sample size considerations.</p>
<p>Tabulate detection distances using a <code>LTabundR</code> function:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="subgroups2.html#cb221-1" tabindex="-1"></a>dists <span class="ot">&lt;-</span> </span>
<span id="cb221-2"><a href="subgroups2.html#cb221-2" tabindex="-1"></a>  <span class="fu">summarize_distances</span>(df_sits<span class="sc">$</span>PerpDistKm) <span class="sc">%&gt;%</span> </span>
<span id="cb221-3"><a href="subgroups2.html#cb221-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>total_within)</span>
<span id="cb221-4"><a href="subgroups2.html#cb221-4" tabindex="-1"></a></span>
<span id="cb221-5"><a href="subgroups2.html#cb221-5" tabindex="-1"></a>dists</span>
<span id="cb221-6"><a href="subgroups2.html#cb221-6" tabindex="-1"></a>   km_min_incl km_max_excl sightings percent_beyond total_beyond km_mid</span>
<span id="cb221-7"><a href="subgroups2.html#cb221-7" tabindex="-1"></a><span class="dv">1</span>          <span class="fl">0.0</span>         <span class="fl">0.0</span>         <span class="dv">5</span>     <span class="fl">95.3703704</span>          <span class="dv">103</span>   <span class="fl">0.00</span></span>
<span id="cb221-8"><a href="subgroups2.html#cb221-8" tabindex="-1"></a><span class="dv">2</span>          <span class="fl">0.0</span>         <span class="fl">0.5</span>        <span class="dv">31</span>     <span class="fl">66.6666667</span>           <span class="dv">72</span>   <span class="fl">0.25</span></span>
<span id="cb221-9"><a href="subgroups2.html#cb221-9" tabindex="-1"></a><span class="dv">3</span>          <span class="fl">0.5</span>         <span class="fl">1.0</span>        <span class="dv">16</span>     <span class="fl">51.8518519</span>           <span class="dv">56</span>   <span class="fl">0.75</span></span>
<span id="cb221-10"><a href="subgroups2.html#cb221-10" tabindex="-1"></a><span class="dv">4</span>          <span class="fl">1.0</span>         <span class="fl">1.5</span>        <span class="dv">15</span>     <span class="fl">37.9629630</span>           <span class="dv">41</span>   <span class="fl">1.25</span></span>
<span id="cb221-11"><a href="subgroups2.html#cb221-11" tabindex="-1"></a><span class="dv">5</span>          <span class="fl">1.5</span>         <span class="fl">2.0</span>        <span class="dv">10</span>     <span class="fl">28.7037037</span>           <span class="dv">31</span>   <span class="fl">1.75</span></span>
<span id="cb221-12"><a href="subgroups2.html#cb221-12" tabindex="-1"></a><span class="dv">6</span>          <span class="fl">2.0</span>         <span class="fl">2.5</span>         <span class="dv">4</span>     <span class="fl">25.0000000</span>           <span class="dv">27</span>   <span class="fl">2.25</span></span>
<span id="cb221-13"><a href="subgroups2.html#cb221-13" tabindex="-1"></a><span class="dv">7</span>          <span class="fl">2.5</span>         <span class="fl">3.0</span>         <span class="dv">6</span>     <span class="fl">19.4444444</span>           <span class="dv">21</span>   <span class="fl">2.75</span></span>
<span id="cb221-14"><a href="subgroups2.html#cb221-14" tabindex="-1"></a><span class="dv">8</span>          <span class="fl">3.0</span>         <span class="fl">3.5</span>         <span class="dv">5</span>     <span class="fl">14.8148148</span>           <span class="dv">16</span>   <span class="fl">3.25</span></span>
<span id="cb221-15"><a href="subgroups2.html#cb221-15" tabindex="-1"></a><span class="dv">9</span>          <span class="fl">3.5</span>         <span class="fl">4.0</span>         <span class="dv">2</span>     <span class="fl">12.9629630</span>           <span class="dv">14</span>   <span class="fl">3.75</span></span>
<span id="cb221-16"><a href="subgroups2.html#cb221-16" tabindex="-1"></a><span class="dv">10</span>         <span class="fl">4.0</span>         <span class="fl">4.5</span>         <span class="dv">6</span>      <span class="fl">7.4074074</span>            <span class="dv">8</span>   <span class="fl">4.25</span></span>
<span id="cb221-17"><a href="subgroups2.html#cb221-17" tabindex="-1"></a><span class="dv">11</span>         <span class="fl">4.5</span>         <span class="fl">5.0</span>         <span class="dv">2</span>      <span class="fl">5.5555556</span>            <span class="dv">6</span>   <span class="fl">4.75</span></span>
<span id="cb221-18"><a href="subgroups2.html#cb221-18" tabindex="-1"></a><span class="dv">12</span>         <span class="fl">5.0</span>         <span class="fl">5.5</span>         <span class="dv">1</span>      <span class="fl">4.6296296</span>            <span class="dv">5</span>   <span class="fl">5.25</span></span>
<span id="cb221-19"><a href="subgroups2.html#cb221-19" tabindex="-1"></a><span class="dv">13</span>         <span class="fl">5.5</span>         <span class="fl">6.0</span>         <span class="dv">1</span>      <span class="fl">3.7037037</span>            <span class="dv">4</span>   <span class="fl">5.75</span></span>
<span id="cb221-20"><a href="subgroups2.html#cb221-20" tabindex="-1"></a><span class="dv">14</span>         <span class="fl">6.0</span>         <span class="fl">6.5</span>         <span class="dv">1</span>      <span class="fl">2.7777778</span>            <span class="dv">3</span>   <span class="fl">6.25</span></span>
<span id="cb221-21"><a href="subgroups2.html#cb221-21" tabindex="-1"></a><span class="dv">15</span>         <span class="fl">6.5</span>         <span class="fl">7.0</span>         <span class="dv">1</span>      <span class="fl">1.8518519</span>            <span class="dv">2</span>   <span class="fl">6.75</span></span>
<span id="cb221-22"><a href="subgroups2.html#cb221-22" tabindex="-1"></a><span class="dv">16</span>         <span class="fl">7.0</span>         <span class="fl">7.5</span>         <span class="dv">0</span>      <span class="fl">1.8518519</span>            <span class="dv">2</span>   <span class="fl">7.25</span></span>
<span id="cb221-23"><a href="subgroups2.html#cb221-23" tabindex="-1"></a><span class="dv">17</span>         <span class="fl">7.5</span>         <span class="fl">8.0</span>         <span class="dv">1</span>      <span class="fl">0.9259259</span>            <span class="dv">1</span>   <span class="fl">7.75</span></span>
<span id="cb221-24"><a href="subgroups2.html#cb221-24" tabindex="-1"></a><span class="dv">18</span>         <span class="fl">8.0</span>         <span class="fl">8.5</span>         <span class="dv">1</span>      <span class="fl">0.0000000</span>            <span class="dv">0</span>   <span class="fl">8.25</span></span></code></pre></div>
<p>Plot these options:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="subgroups2.html#cb222-1" tabindex="-1"></a><span class="fu">ggplot</span>(dists, <span class="fu">aes</span>(<span class="at">x=</span>km_max_excl, <span class="at">y=</span>percent_beyond)) <span class="sc">+</span> </span>
<span id="cb222-2"><a href="subgroups2.html#cb222-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_path</span>() <span class="sc">+</span> </span>
<span id="cb222-3"><a href="subgroups2.html#cb222-3" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">10</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">color=</span><span class="st">&#39;firebrick&#39;</span>) <span class="sc">+</span> </span>
<span id="cb222-4"><a href="subgroups2.html#cb222-4" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Percent of sightings beyond this distance&#39;</span>) <span class="sc">+</span></span>
<span id="cb222-5"><a href="subgroups2.html#cb222-5" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Perpendicular distance (km)&#39;</span>) <span class="sc">+</span> </span>
<span id="cb222-6"><a href="subgroups2.html#cb222-6" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb222-7"><a href="subgroups2.html#cb222-7" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">n.breaks =</span> <span class="dv">10</span>) </span></code></pre></div>
<p><img src="figures/unnamed-chunk-278-1.png" width="672" /></p>
<p>Based on these results, we will choose a truncation distance of 4.5 km.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="subgroups2.html#cb223-1" tabindex="-1"></a>truncation_distance <span class="ot">&lt;-</span> <span class="fl">4.5</span></span></code></pre></div>
</div>
<div id="ss" class="section level3 unnumbered hasAnchor">
<h3><code>ss</code><a href="subgroups2.html#ss" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is a numeric vector of subgroup school sizes. The function will find this vector’s arithmetic mean and bootstrapped CV. In <a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. (2020)</a>, school size data come from all Phase 1 and Phase 2 estimates of subgroup sizes from 2011 onwards. In the processed <code>cruz</code> object, each of those estimates is the geometric mean of repeat estimates from separate observers.</p>
<p>Some of these estimates need to be removed for various reasons that were not captured in the original <code>DAS</code> file. However, these estimates should only be removed from the dataset used for school size estimation – they could still be used in <code>df_sits</code> and other inputs as long as their details meet their respective criteria. The vectors below provide the subgroup ID’s that should be removed for the purposes of group size estimation:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="subgroups2.html#cb224-1" tabindex="-1"></a><span class="co"># Subgroup missed by primary observer</span></span>
<span id="cb224-2"><a href="subgroups2.html#cb224-2" tabindex="-1"></a>missed_by_primary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;1706-20170912-119-M&#39;</span>,</span>
<span id="cb224-3"><a href="subgroups2.html#cb224-3" tabindex="-1"></a>                       <span class="st">&#39;1706-20170912-119-P&#39;</span>,</span>
<span id="cb224-4"><a href="subgroups2.html#cb224-4" tabindex="-1"></a>                       <span class="st">&#39;1706-20170913-122-C&#39;</span>,</span>
<span id="cb224-5"><a href="subgroups2.html#cb224-5" tabindex="-1"></a>                       <span class="st">&#39;1705-20170913-122-E&#39;</span>,</span>
<span id="cb224-6"><a href="subgroups2.html#cb224-6" tabindex="-1"></a>                       <span class="st">&#39;1706-20170917-133-G&#39;</span>)</span>
<span id="cb224-7"><a href="subgroups2.html#cb224-7" tabindex="-1"></a></span>
<span id="cb224-8"><a href="subgroups2.html#cb224-8" tabindex="-1"></a><span class="co"># Subgroup occurred in a mixed species sighting</span></span>
<span id="cb224-9"><a href="subgroups2.html#cb224-9" tabindex="-1"></a>mixed_spp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1203-20120513-069-A&quot;</span>,</span>
<span id="cb224-10"><a href="subgroups2.html#cb224-10" tabindex="-1"></a>               <span class="st">&quot;1203-20120513-069-SB&quot;</span>,</span>
<span id="cb224-11"><a href="subgroups2.html#cb224-11" tabindex="-1"></a>               <span class="st">&quot;1203-20120513-069-SC&quot;</span>,</span>
<span id="cb224-12"><a href="subgroups2.html#cb224-12" tabindex="-1"></a>               <span class="st">&quot;1203-20120513-069-ZA&quot;</span>,</span>
<span id="cb224-13"><a href="subgroups2.html#cb224-13" tabindex="-1"></a>               <span class="st">&quot;1203-20120513-069-ZC&quot;</span>)</span>
<span id="cb224-14"><a href="subgroups2.html#cb224-14" tabindex="-1"></a></span>
<span id="cb224-15"><a href="subgroups2.html#cb224-15" tabindex="-1"></a><span class="co"># Phase assignments compromised</span></span>
<span id="cb224-16"><a href="subgroups2.html#cb224-16" tabindex="-1"></a>phase_compromised <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1303-20130526-059-B&quot;</span>,</span>
<span id="cb224-17"><a href="subgroups2.html#cb224-17" tabindex="-1"></a>                       <span class="st">&quot;1303-20130526-059-C&quot;</span>,</span>
<span id="cb224-18"><a href="subgroups2.html#cb224-18" tabindex="-1"></a>                       <span class="st">&quot;1303-20130526-059-D&quot;</span>,</span>
<span id="cb224-19"><a href="subgroups2.html#cb224-19" tabindex="-1"></a>                       <span class="st">&quot;1604-20160704-018-A&quot;</span>, <span class="co"># could not find in the data</span></span>
<span id="cb224-20"><a href="subgroups2.html#cb224-20" tabindex="-1"></a>                       <span class="st">&quot;1705-20170820-016-A&quot;</span>,</span>
<span id="cb224-21"><a href="subgroups2.html#cb224-21" tabindex="-1"></a>                       <span class="st">&quot;1705-20170911-055-SA&quot;</span>,</span>
<span id="cb224-22"><a href="subgroups2.html#cb224-22" tabindex="-1"></a>                       <span class="st">&quot;1705-20171009-086-A&quot;</span>,</span>
<span id="cb224-23"><a href="subgroups2.html#cb224-23" tabindex="-1"></a>                       <span class="st">&quot;1705-20171102-116-A&quot;</span>,</span>
<span id="cb224-24"><a href="subgroups2.html#cb224-24" tabindex="-1"></a>                       <span class="st">&quot;1705-20171102-116-B&quot;</span>,</span>
<span id="cb224-25"><a href="subgroups2.html#cb224-25" tabindex="-1"></a>                       <span class="st">&quot;1705-20171117-136-A&quot;</span>) <span class="co"># could not find in the data</span></span>
<span id="cb224-26"><a href="subgroups2.html#cb224-26" tabindex="-1"></a></span>
<span id="cb224-27"><a href="subgroups2.html#cb224-27" tabindex="-1"></a><span class="co"># Subgroup fluidity</span></span>
<span id="cb224-28"><a href="subgroups2.html#cb224-28" tabindex="-1"></a>subgroup_fluidity <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;1203-20120516-076-SA&#39;</span>)</span></code></pre></div>
<p>We first remove these subgroup IDs from the raw subgroup data, found in the <code>events</code> slot in the <code>subgroups</code> slot of the <code>cruz</code> cohort:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="subgroups2.html#cb225-1" tabindex="-1"></a>events <span class="ot">&lt;-</span> cruz<span class="sc">$</span>cohorts<span class="sc">$</span>all<span class="sc">$</span>subgroups<span class="sc">$</span>events</span>
<span id="cb225-2"><a href="subgroups2.html#cb225-2" tabindex="-1"></a></span>
<span id="cb225-3"><a href="subgroups2.html#cb225-3" tabindex="-1"></a>events <span class="ot">&lt;-</span> events <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span> sgid <span class="sc">%in%</span> missed_by_primary,</span>
<span id="cb225-4"><a href="subgroups2.html#cb225-4" tabindex="-1"></a>                            <span class="sc">!</span> sgid <span class="sc">%in%</span> mixed_spp,</span>
<span id="cb225-5"><a href="subgroups2.html#cb225-5" tabindex="-1"></a>                            <span class="sc">!</span> sgid <span class="sc">%in%</span> phase_compromised,</span>
<span id="cb225-6"><a href="subgroups2.html#cb225-6" tabindex="-1"></a>                            <span class="sc">!</span> sgid <span class="sc">%in%</span> subgroup_fluidity)</span></code></pre></div>
<p>We then use the <code>LTabundR</code> function <code>subgroup_subgroups()</code> to turn these observer-level detections into a single row for each subgroup, with group sizes averaged using the geometric mean:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="subgroups2.html#cb226-1" tabindex="-1"></a>subgroups <span class="ot">&lt;-</span> <span class="fu">subgroup_subgroups</span>(events)</span></code></pre></div>
<p>We can then use these subgroups to conduct additional filtering for each phase of the PC protocol. Phase 1 detections need to be within 4.5km, not past the beam, and made by primary observer with a valid “best” estimate.. Phase 2 detections need to be within 4.5km and with a valid “best” estimate.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="subgroups2.html#cb227-1" tabindex="-1"></a><span class="co"># Filter that apply to both phases</span></span>
<span id="cb227-2"><a href="subgroups2.html#cb227-2" tabindex="-1"></a>ss  <span class="ot">&lt;-</span></span>
<span id="cb227-3"><a href="subgroups2.html#cb227-3" tabindex="-1"></a>  subgroups <span class="sc">%&gt;%</span> </span>
<span id="cb227-4"><a href="subgroups2.html#cb227-4" tabindex="-1"></a>  <span class="fu">filter</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(DateTime) <span class="sc">&gt;=</span> <span class="dv">2011</span>,</span>
<span id="cb227-5"><a href="subgroups2.html#cb227-5" tabindex="-1"></a>         lubridate<span class="sc">::</span><span class="fu">year</span>(DateTime) <span class="sc">&lt;=</span> <span class="dv">2017</span>,</span>
<span id="cb227-6"><a href="subgroups2.html#cb227-6" tabindex="-1"></a>         GSBest_geom_valid <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb227-7"><a href="subgroups2.html#cb227-7" tabindex="-1"></a>         stratum_OtherCNP <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb227-8"><a href="subgroups2.html#cb227-8" tabindex="-1"></a>         Species <span class="sc">==</span> <span class="st">&#39;033&#39;</span>,</span>
<span id="cb227-9"><a href="subgroups2.html#cb227-9" tabindex="-1"></a>         PerpDist <span class="sc">&lt;=</span> <span class="fl">4.5</span>) </span></code></pre></div>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="subgroups2.html#cb228-1" tabindex="-1"></a><span class="co"># Additional Phase 1 filters</span></span>
<span id="cb228-2"><a href="subgroups2.html#cb228-2" tabindex="-1"></a>ss_phase1 <span class="ot">&lt;-</span> </span>
<span id="cb228-3"><a href="subgroups2.html#cb228-3" tabindex="-1"></a>  ss <span class="sc">%&gt;%</span> </span>
<span id="cb228-4"><a href="subgroups2.html#cb228-4" tabindex="-1"></a>  <span class="fu">filter</span>(Phase <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb228-5"><a href="subgroups2.html#cb228-5" tabindex="-1"></a>         Angle <span class="sc">&lt;=</span> <span class="dv">90</span>)</span>
<span id="cb228-6"><a href="subgroups2.html#cb228-6" tabindex="-1"></a></span>
<span id="cb228-7"><a href="subgroups2.html#cb228-7" tabindex="-1"></a>ss_phase1 <span class="sc">%&gt;%</span> nrow</span>
<span id="cb228-8"><a href="subgroups2.html#cb228-8" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">63</span></span></code></pre></div>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="subgroups2.html#cb229-1" tabindex="-1"></a><span class="co"># Additional Phase 2</span></span>
<span id="cb229-2"><a href="subgroups2.html#cb229-2" tabindex="-1"></a>ss_phase2 <span class="ot">&lt;-</span> </span>
<span id="cb229-3"><a href="subgroups2.html#cb229-3" tabindex="-1"></a>  ss <span class="sc">%&gt;%</span> </span>
<span id="cb229-4"><a href="subgroups2.html#cb229-4" tabindex="-1"></a>  <span class="fu">filter</span>(Phase <span class="sc">==</span> <span class="dv">2</span>)</span>
<span id="cb229-5"><a href="subgroups2.html#cb229-5" tabindex="-1"></a></span>
<span id="cb229-6"><a href="subgroups2.html#cb229-6" tabindex="-1"></a>ss_phase2 <span class="sc">%&gt;%</span> nrow</span>
<span id="cb229-7"><a href="subgroups2.html#cb229-7" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">64</span></span></code></pre></div>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="subgroups2.html#cb230-1" tabindex="-1"></a><span class="co"># Combine</span></span>
<span id="cb230-2"><a href="subgroups2.html#cb230-2" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">rbind</span>(ss_phase1, ss_phase2) </span></code></pre></div>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="subgroups2.html#cb231-1" tabindex="-1"></a><span class="co"># Pull out group size vector</span></span>
<span id="cb231-2"><a href="subgroups2.html#cb231-2" tabindex="-1"></a>ss <span class="ot">&lt;-</span> ss <span class="sc">%&gt;%</span> <span class="fu">pull</span>(GSBest_geom)</span>
<span id="cb231-3"><a href="subgroups2.html#cb231-3" tabindex="-1"></a></span>
<span id="cb231-4"><a href="subgroups2.html#cb231-4" tabindex="-1"></a><span class="co"># Check sample size</span></span>
<span id="cb231-5"><a href="subgroups2.html#cb231-5" tabindex="-1"></a>ss <span class="sc">%&gt;%</span> length</span>
<span id="cb231-6"><a href="subgroups2.html#cb231-6" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">127</span></span>
<span id="cb231-7"><a href="subgroups2.html#cb231-7" tabindex="-1"></a></span>
<span id="cb231-8"><a href="subgroups2.html#cb231-8" tabindex="-1"></a>ss</span>
<span id="cb231-9"><a href="subgroups2.html#cb231-9" tabindex="-1"></a>  [<span class="dv">1</span>] <span class="fl">5.00</span> <span class="fl">7.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">4.00</span> <span class="fl">4.47</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">5.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">2.00</span> <span class="fl">4.12</span> <span class="fl">7.09</span></span>
<span id="cb231-10"><a href="subgroups2.html#cb231-10" tabindex="-1"></a> [<span class="dv">16</span>] <span class="fl">2.83</span> <span class="fl">3.00</span> <span class="fl">2.88</span> <span class="fl">2.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">2.00</span> <span class="fl">1.00</span> <span class="fl">2.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">2.00</span></span>
<span id="cb231-11"><a href="subgroups2.html#cb231-11" tabindex="-1"></a> [<span class="dv">31</span>] <span class="fl">3.63</span> <span class="fl">2.00</span> <span class="fl">2.00</span> <span class="fl">8.00</span> <span class="fl">4.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">4.00</span> <span class="fl">2.00</span> <span class="fl">2.00</span> <span class="fl">2.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">2.00</span> <span class="fl">1.00</span></span>
<span id="cb231-12"><a href="subgroups2.html#cb231-12" tabindex="-1"></a> [<span class="dv">46</span>] <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">2.00</span> <span class="fl">2.00</span> <span class="fl">1.73</span> <span class="fl">7.48</span> <span class="fl">1.41</span> <span class="fl">1.00</span> <span class="fl">3.00</span> <span class="fl">1.41</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">2.83</span></span>
<span id="cb231-13"><a href="subgroups2.html#cb231-13" tabindex="-1"></a> [<span class="dv">61</span>] <span class="fl">2.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">3.66</span> <span class="fl">1.26</span> <span class="fl">1.00</span> <span class="fl">1.73</span> <span class="fl">4.76</span> <span class="fl">1.73</span> <span class="fl">1.00</span> <span class="fl">3.78</span> <span class="fl">4.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span></span>
<span id="cb231-14"><a href="subgroups2.html#cb231-14" tabindex="-1"></a> [<span class="dv">76</span>] <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">2.00</span> <span class="fl">3.46</span> <span class="fl">4.24</span> <span class="fl">2.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">1.86</span> <span class="fl">2.47</span> <span class="fl">1.41</span> <span class="fl">2.52</span> <span class="fl">1.26</span></span>
<span id="cb231-15"><a href="subgroups2.html#cb231-15" tabindex="-1"></a> [<span class="dv">91</span>] <span class="fl">2.00</span> <span class="fl">6.00</span> <span class="fl">4.16</span> <span class="fl">2.00</span> <span class="fl">1.00</span> <span class="fl">3.00</span> <span class="fl">5.00</span> <span class="fl">5.67</span> <span class="fl">2.00</span> <span class="fl">2.00</span> <span class="fl">4.00</span> <span class="fl">4.47</span> <span class="fl">2.00</span> <span class="fl">2.00</span> <span class="fl">2.00</span></span>
<span id="cb231-16"><a href="subgroups2.html#cb231-16" tabindex="-1"></a>[<span class="dv">106</span>] <span class="fl">4.47</span> <span class="fl">2.00</span> <span class="fl">1.41</span> <span class="fl">4.47</span> <span class="fl">1.00</span> <span class="fl">1.00</span> <span class="fl">3.17</span> <span class="fl">2.88</span> <span class="fl">2.00</span> <span class="fl">2.00</span> <span class="fl">6.00</span> <span class="fl">5.00</span> <span class="fl">8.12</span> <span class="fl">2.38</span> <span class="fl">1.00</span></span>
<span id="cb231-17"><a href="subgroups2.html#cb231-17" tabindex="-1"></a>[<span class="dv">121</span>] <span class="fl">1.00</span> <span class="fl">2.00</span> <span class="fl">1.00</span> <span class="fl">2.00</span> <span class="fl">2.83</span> <span class="fl">3.00</span> <span class="fl">2.00</span></span></code></pre></div>
<p>The sample size in <a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. (2020)</a> is n=127 (63 from phase 1, 64 from phase 2).</p>
</div>
<div id="rg0-1" class="section level3 unnumbered hasAnchor">
<h3><code>Rg0</code><a href="subgroups2.html#rg0-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is a <code>data.frame</code> with estimates of Relative <em>g(0)</em> and its CV at each Beaufort sea state. If this input is left <code>NULL</code>, then these estimates will be produced by the function using the subsequent <code>g0_</code> inputs below. If this input is <em>not</em> supplied and any of the subsequent <code>g0_</code> inputs are missing, then <em>g(0)</em> will be assumed to be 1.0 with CV of 0.0.</p>
<p>When you do supply this <code>Rg0</code> input, the <code>data.frame</code> has three required columns: <code>bft</code> (Beaufort sea state, numbers between 0 and 6), <code>Rg0</code> (<em>Rg(0)</em> estimates for each Beaufort state), <code>Rg0_CV</code> (the CV of the <em>Rg(0)</em> estimate in each Beaufort state). Other columns are allowed but will be ignored.</p>
<p>Here is an example of a valid <code>Rg0</code> input based on the values reported for false killer whales in <a href="https://www.fisheries.noaa.gov/inport/item/59592">Bradford et al. (2020)</a>. (These numbers are also available in the built-in dataset <code>data(barlow_2015)</code>.).</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="subgroups2.html#cb232-1" tabindex="-1"></a>Rg0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">bft =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>,</span>
<span id="cb232-2"><a href="subgroups2.html#cb232-2" tabindex="-1"></a>                  <span class="at">Rg0 =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.72</span>, <span class="fl">0.51</span>, <span class="fl">0.37</span>, <span class="fl">0.26</span>, <span class="fl">0.19</span>),</span>
<span id="cb232-3"><a href="subgroups2.html#cb232-3" tabindex="-1"></a>                  <span class="at">Rg0_CV =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.11</span>, <span class="fl">0.22</span>, <span class="fl">0.34</span>, <span class="fl">0.46</span>, <span class="fl">0.59</span>))</span>
<span id="cb232-4"><a href="subgroups2.html#cb232-4" tabindex="-1"></a></span>
<span id="cb232-5"><a href="subgroups2.html#cb232-5" tabindex="-1"></a>Rg0</span>
<span id="cb232-6"><a href="subgroups2.html#cb232-6" tabindex="-1"></a>  bft  Rg0 Rg0_CV</span>
<span id="cb232-7"><a href="subgroups2.html#cb232-7" tabindex="-1"></a><span class="dv">1</span>   <span class="dv">0</span> <span class="fl">1.00</span>   <span class="fl">0.00</span></span>
<span id="cb232-8"><a href="subgroups2.html#cb232-8" tabindex="-1"></a><span class="dv">2</span>   <span class="dv">1</span> <span class="fl">1.00</span>   <span class="fl">0.00</span></span>
<span id="cb232-9"><a href="subgroups2.html#cb232-9" tabindex="-1"></a><span class="dv">3</span>   <span class="dv">2</span> <span class="fl">0.72</span>   <span class="fl">0.11</span></span>
<span id="cb232-10"><a href="subgroups2.html#cb232-10" tabindex="-1"></a><span class="dv">4</span>   <span class="dv">3</span> <span class="fl">0.51</span>   <span class="fl">0.22</span></span>
<span id="cb232-11"><a href="subgroups2.html#cb232-11" tabindex="-1"></a><span class="dv">5</span>   <span class="dv">4</span> <span class="fl">0.37</span>   <span class="fl">0.34</span></span>
<span id="cb232-12"><a href="subgroups2.html#cb232-12" tabindex="-1"></a><span class="dv">6</span>   <span class="dv">5</span> <span class="fl">0.26</span>   <span class="fl">0.46</span></span>
<span id="cb232-13"><a href="subgroups2.html#cb232-13" tabindex="-1"></a><span class="dv">7</span>   <span class="dv">6</span> <span class="fl">0.19</span>   <span class="fl">0.59</span></span></code></pre></div>
<p>Again: if you supply this input, then the following <code>g0_</code> inputs will be ignored.</p>
</div>
<div id="cruz10" class="section level3 unnumbered hasAnchor">
<h3><code>cruz10</code><a href="subgroups2.html#cruz10" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is a processed <code>cruz</code> object with short segment lengths, ideally 10 km or less (hence the 10 in the input name). This <code>cruz</code> object will be used to estimate <em>Rg(0)</em>, i.e., the relative trackline detection probability (see its chapter), using the following <code>g0_</code> inputs. The built-in dataset we have already laoded, <code>data("noaa_10km_1986_2020")</code> is already processed with 10-km segments.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="subgroups2.html#cb233-1" tabindex="-1"></a>cruz10 <span class="ot">&lt;-</span> cruz</span></code></pre></div>
</div>
<div id="g0_spp" class="section level3 unnumbered hasAnchor">
<h3><code>g0_spp</code><a href="subgroups2.html#g0_spp" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This and the following <code>g0_</code> inputs will be used to model Relative <em>g(0)</em> estimates and their CV in various Beaufort sea states. If the previous input, <code>Rg0</code> is provided, then these <code>g0_</code> inputs will be ignored, and no <em>Rg(0)</em> modeling will take place. Furthermore, if any of these <code>g0_</code> inputs are not provided, <em>Rg(0)</em> will be coerced to 1.0 with a CV of 0.0 for all sea states.</p>
<p>This input, <code>g0_spp</code>, is a character vector of species code(s) to use to estimate <em>Rg(0)</em>. In most cases this will be a single species, e.g., <code>"033"</code> for false killer whales.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="subgroups2.html#cb234-1" tabindex="-1"></a>g0_spp <span class="ot">&lt;-</span> <span class="st">&#39;033&#39;</span></span></code></pre></div>
</div>
<div id="g0_truncation" class="section level3 unnumbered hasAnchor">
<h3><code>g0_truncation</code><a href="subgroups2.html#g0_truncation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The truncation distance to use when estimating <em>Rg(0)</em>. In <a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. (2020)</a> this is 5.5 km.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="subgroups2.html#cb235-1" tabindex="-1"></a>g0_truncation <span class="ot">&lt;-</span> <span class="fl">5.5</span></span></code></pre></div>
</div>
<div id="g0_constrain_shape" class="section level3 unnumbered hasAnchor">
<h3><code>g0_constrain_shape</code><a href="subgroups2.html#g0_constrain_shape" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Some <em>Rg(0)</em> curves will not decline monotonically due to sample size issues at low Bft (0-2) or high Bft (5-6) states. To coerce monotonic decline, set this input to <code>TRUE</code>, and the function will use a shape-constrained GAM (<code>scam()</code> from package <code>scam</code>) instead of a classic <code>mgcv::gam()</code>.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="subgroups2.html#cb236-1" tabindex="-1"></a>g0_constrain_shape <span class="ot">=</span> <span class="cn">FALSE</span></span></code></pre></div>
</div>
<div id="g0_jackknife_fraction" class="section level3 unnumbered hasAnchor">
<h3><code>g0_jackknife_fraction</code><a href="subgroups2.html#g0_jackknife_fraction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The proportion of data to leave out within each jackknife permutation. The default is <code>0.1</code> (i.e., 10% of the data, yielding 10 jackknife loops), after <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/mms.12205">Barlow (2015)</a>.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="subgroups2.html#cb237-1" tabindex="-1"></a>g0_jackknife_fraction <span class="ot">=</span> <span class="fl">0.1</span></span></code></pre></div>
</div>
<div id="density_segments" class="section level3 unnumbered hasAnchor">
<h3><code>density_segments</code><a href="subgroups2.html#density_segments" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The survey segments to be used in density/abundance estimation. For example, <a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. (2020)</a> used 150-km segments to estimate false killer whale density in the Hawaiian EEZ in 2017. For this we can use the 1986-2020 dataset we loaded above, but we need to re-segmentize the <code>cruz</code> object since it was originally processed for 10-km segments.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="subgroups2.html#cb238-1" tabindex="-1"></a><span class="co"># Save a safe copy</span></span>
<span id="cb238-2"><a href="subgroups2.html#cb238-2" tabindex="-1"></a>cruz150 <span class="ot">&lt;-</span> cruz</span></code></pre></div>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="subgroups2.html#cb239-1" tabindex="-1"></a><span class="co"># Resegmentize</span></span>
<span id="cb239-2"><a href="subgroups2.html#cb239-2" tabindex="-1"></a>cruz150 <span class="ot">&lt;-</span> </span>
<span id="cb239-3"><a href="subgroups2.html#cb239-3" tabindex="-1"></a>  <span class="fu">segmentize</span>(cruz150, </span>
<span id="cb239-4"><a href="subgroups2.html#cb239-4" tabindex="-1"></a>             <span class="at">segment_method =</span> <span class="st">&#39;equallength&#39;</span>,</span>
<span id="cb239-5"><a href="subgroups2.html#cb239-5" tabindex="-1"></a>             <span class="at">segment_target_km =</span> <span class="dv">150</span>,</span>
<span id="cb239-6"><a href="subgroups2.html#cb239-6" tabindex="-1"></a>             <span class="at">segment_max_interval =</span> <span class="dv">48</span>,</span>
<span id="cb239-7"><a href="subgroups2.html#cb239-7" tabindex="-1"></a>             <span class="at">segment_remainder_handling =</span> <span class="fu">c</span>(<span class="st">&#39;segment&#39;</span>),</span>
<span id="cb239-8"><a href="subgroups2.html#cb239-8" tabindex="-1"></a>             <span class="at">beaufort_range =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>,</span>
<span id="cb239-9"><a href="subgroups2.html#cb239-9" tabindex="-1"></a>             <span class="at">distance_types =</span> <span class="fu">c</span>(<span class="st">&#39;S&#39;</span>, <span class="st">&#39;F&#39;</span>, <span class="st">&#39;N&#39;</span>),</span>
<span id="cb239-10"><a href="subgroups2.html#cb239-10" tabindex="-1"></a>             <span class="at">verbose=</span><span class="cn">FALSE</span>)</span>
<span id="cb239-11"><a href="subgroups2.html#cb239-11" tabindex="-1"></a></span>
<span id="cb239-12"><a href="subgroups2.html#cb239-12" tabindex="-1"></a><span class="co"># Re-process sightings</span></span>
<span id="cb239-13"><a href="subgroups2.html#cb239-13" tabindex="-1"></a>cruz150 <span class="ot">&lt;-</span> <span class="fu">process_sightings</span>(cruz150, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span>
<span id="cb239-14"><a href="subgroups2.html#cb239-14" tabindex="-1"></a></span>
<span id="cb239-15"><a href="subgroups2.html#cb239-15" tabindex="-1"></a><span class="co"># Re-process subgroups</span></span>
<span id="cb239-16"><a href="subgroups2.html#cb239-16" tabindex="-1"></a>cruz150 <span class="ot">&lt;-</span> <span class="fu">process_subgroups</span>(cruz150, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>Note that no filtering will be applied to these segments by the <code>lta_subgroup()</code> function, so we need to filter them ourselves first: we want only systematic segments for the Hawaiian EEZ in 2017 (specifically, just cruises 1705 and 1706).</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="subgroups2.html#cb240-1" tabindex="-1"></a>cruzi <span class="ot">&lt;-</span> <span class="fu">filter_cruz</span>(<span class="at">cruz =</span> cruz150,</span>
<span id="cb240-2"><a href="subgroups2.html#cb240-2" tabindex="-1"></a>                      <span class="at">analysis_only =</span> <span class="cn">TRUE</span>,</span>
<span id="cb240-3"><a href="subgroups2.html#cb240-3" tabindex="-1"></a>                      <span class="at">years =</span> <span class="dv">2017</span>,</span>
<span id="cb240-4"><a href="subgroups2.html#cb240-4" tabindex="-1"></a>                      <span class="at">cruises =</span> <span class="fu">c</span>(<span class="dv">1705</span>, <span class="dv">1706</span>),</span>
<span id="cb240-5"><a href="subgroups2.html#cb240-5" tabindex="-1"></a>                      <span class="at">regions =</span> <span class="st">&#39;HI_EEZ&#39;</span>,</span>
<span id="cb240-6"><a href="subgroups2.html#cb240-6" tabindex="-1"></a>                      <span class="at">bft_range =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>,</span>
<span id="cb240-7"><a href="subgroups2.html#cb240-7" tabindex="-1"></a>                      <span class="at">eff_types =</span> <span class="st">&#39;S&#39;</span>,</span>
<span id="cb240-8"><a href="subgroups2.html#cb240-8" tabindex="-1"></a>                      <span class="at">on_off =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>At this point we need to batch-assign detections to their respective populations. To do so, we draw stock boundary polygons from the <code>cruz</code> strata:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="subgroups2.html#cb241-1" tabindex="-1"></a>mhi <span class="ot">&lt;-</span> cruz<span class="sc">$</span>settings<span class="sc">$</span>strata<span class="sc">$</span>MHI</span>
<span id="cb241-2"><a href="subgroups2.html#cb241-2" tabindex="-1"></a>nwhi <span class="ot">&lt;-</span> cruz<span class="sc">$</span>settings<span class="sc">$</span>strata<span class="sc">$</span>NWHI</span>
<span id="cb241-3"><a href="subgroups2.html#cb241-3" tabindex="-1"></a>populations <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">MHI =</span> mhi,</span>
<span id="cb241-4"><a href="subgroups2.html#cb241-4" tabindex="-1"></a>                    <span class="at">NWHI =</span> nwhi)</span></code></pre></div>
<p>We then run the function <code>subgroup_populations()</code> to automatically assign each subgroup to a population based on their location within those polygons:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="subgroups2.html#cb242-1" tabindex="-1"></a><span class="co"># Stage edits</span></span>
<span id="cb242-2"><a href="subgroups2.html#cb242-2" tabindex="-1"></a>pops <span class="ot">&lt;-</span> <span class="fu">subgroup_populations</span>(populations,</span>
<span id="cb242-3"><a href="subgroups2.html#cb242-3" tabindex="-1"></a>                             cruzi,</span>
<span id="cb242-4"><a href="subgroups2.html#cb242-4" tabindex="-1"></a>                             <span class="at">cohort=</span><span class="dv">1</span>,</span>
<span id="cb242-5"><a href="subgroups2.html#cb242-5" tabindex="-1"></a>                             <span class="at">default_pop =</span> <span class="st">&#39;pelagic&#39;</span>,</span>
<span id="cb242-6"><a href="subgroups2.html#cb242-6" tabindex="-1"></a>                             <span class="at">verbose=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>Here is a look at what this batch of staged edits looks like:</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="subgroups2.html#cb243-1" tabindex="-1"></a>pops <span class="sc">%&gt;%</span> head</span>
<span id="cb243-2"><a href="subgroups2.html#cb243-2" tabindex="-1"></a><span class="co"># A tibble: 6 × 5</span></span>
<span id="cb243-3"><a href="subgroups2.html#cb243-3" tabindex="-1"></a>  edit       cohort sgid                population pop_prob</span>
<span id="cb243-4"><a href="subgroups2.html#cb243-4" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>               <span class="er">&lt;</span>chr<span class="sc">&gt;</span>      <span class="er">&lt;</span>chr<span class="sc">&gt;</span>   </span>
<span id="cb243-5"><a href="subgroups2.html#cb243-5" tabindex="-1"></a><span class="dv">1</span> population      <span class="dv">1</span> <span class="dv">1705-20170921-064</span><span class="sc">-</span>A pelagic    <span class="dv">1</span>       </span>
<span id="cb243-6"><a href="subgroups2.html#cb243-6" tabindex="-1"></a><span class="dv">2</span> population      <span class="dv">1</span> <span class="dv">1705-20170921-064</span><span class="sc">-</span>B pelagic    <span class="dv">1</span>       </span>
<span id="cb243-7"><a href="subgroups2.html#cb243-7" tabindex="-1"></a><span class="dv">3</span> population      <span class="dv">1</span> <span class="dv">1705-20170921-064</span><span class="sc">-</span>B pelagic    <span class="dv">1</span>       </span>
<span id="cb243-8"><a href="subgroups2.html#cb243-8" tabindex="-1"></a><span class="dv">4</span> population      <span class="dv">1</span> <span class="dv">1705-20170921-064</span><span class="sc">-</span>B pelagic    <span class="dv">1</span>       </span>
<span id="cb243-9"><a href="subgroups2.html#cb243-9" tabindex="-1"></a><span class="dv">5</span> population      <span class="dv">1</span> <span class="dv">1705-20170929-073</span><span class="sc">-</span>A pelagic    <span class="dv">1</span>       </span>
<span id="cb243-10"><a href="subgroups2.html#cb243-10" tabindex="-1"></a><span class="dv">6</span> population      <span class="dv">1</span> <span class="dv">1705-20170929-073</span><span class="sc">-</span>B pelagic    <span class="dv">1</span>       </span>
<span id="cb243-11"><a href="subgroups2.html#cb243-11" tabindex="-1"></a></span>
<span id="cb243-12"><a href="subgroups2.html#cb243-12" tabindex="-1"></a>pops<span class="sc">$</span>population <span class="sc">%&gt;%</span> table</span>
<span id="cb243-13"><a href="subgroups2.html#cb243-13" tabindex="-1"></a>.</span>
<span id="cb243-14"><a href="subgroups2.html#cb243-14" tabindex="-1"></a>     MHI MHI;NWHI     NWHI  pelagic </span>
<span id="cb243-15"><a href="subgroups2.html#cb243-15" tabindex="-1"></a>       <span class="dv">1</span>        <span class="dv">8</span>       <span class="dv">15</span>       <span class="dv">24</span> </span></code></pre></div>
<p>We also need to stage a few specific edits to the processed data, based on the some of the extenuating circumstances discussed in <a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. (2020)</a>.</p>
<p><strong>Sighting 133</strong> subgroups have a special population probability:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="subgroups2.html#cb244-1" tabindex="-1"></a>sit133 <span class="ot">&lt;-</span> </span>
<span id="cb244-2"><a href="subgroups2.html#cb244-2" tabindex="-1"></a>  <span class="fu">subgroup_edits</span>(<span class="at">cohort=</span><span class="dv">1</span>,</span>
<span id="cb244-3"><a href="subgroups2.html#cb244-3" tabindex="-1"></a>                 <span class="at">sgid =</span> <span class="fu">c</span>(<span class="st">&quot;1706-20170917-133-A&quot;</span>,  </span>
<span id="cb244-4"><a href="subgroups2.html#cb244-4" tabindex="-1"></a>                          <span class="st">&quot;1706-20170917-133-B&quot;</span>,  </span>
<span id="cb244-5"><a href="subgroups2.html#cb244-5" tabindex="-1"></a>                          <span class="st">&quot;1706-20170917-133-C&quot;</span>,  </span>
<span id="cb244-6"><a href="subgroups2.html#cb244-6" tabindex="-1"></a>                          <span class="st">&quot;1706-20170917-133-D&quot;</span>,  </span>
<span id="cb244-7"><a href="subgroups2.html#cb244-7" tabindex="-1"></a>                          <span class="st">&quot;1706-20170917-133-E&quot;</span>,</span>
<span id="cb244-8"><a href="subgroups2.html#cb244-8" tabindex="-1"></a>                          <span class="st">&quot;1706-20170917-133-F&quot;</span>),</span>
<span id="cb244-9"><a href="subgroups2.html#cb244-9" tabindex="-1"></a>                 <span class="at">population =</span> <span class="st">&#39;NWHI;pelagic&#39;</span>,</span>
<span id="cb244-10"><a href="subgroups2.html#cb244-10" tabindex="-1"></a>                 <span class="at">pop_prob =</span> <span class="st">&#39;0.4;0.6&#39;</span>)</span>
<span id="cb244-11"><a href="subgroups2.html#cb244-11" tabindex="-1"></a></span>
<span id="cb244-12"><a href="subgroups2.html#cb244-12" tabindex="-1"></a><span class="co"># Check it out</span></span>
<span id="cb244-13"><a href="subgroups2.html#cb244-13" tabindex="-1"></a>sit133</span>
<span id="cb244-14"><a href="subgroups2.html#cb244-14" tabindex="-1"></a>[[<span class="dv">1</span>]]</span>
<span id="cb244-15"><a href="subgroups2.html#cb244-15" tabindex="-1"></a>        edit cohort                sgid   population pop_prob</span>
<span id="cb244-16"><a href="subgroups2.html#cb244-16" tabindex="-1"></a><span class="dv">1</span> population      <span class="dv">1</span> <span class="dv">1706-20170917-133</span><span class="sc">-</span>A NWHI;pelagic  <span class="fl">0.4</span>;<span class="fl">0.6</span></span>
<span id="cb244-17"><a href="subgroups2.html#cb244-17" tabindex="-1"></a><span class="dv">2</span> population      <span class="dv">1</span> <span class="dv">1706-20170917-133</span><span class="sc">-</span>B NWHI;pelagic  <span class="fl">0.4</span>;<span class="fl">0.6</span></span>
<span id="cb244-18"><a href="subgroups2.html#cb244-18" tabindex="-1"></a><span class="dv">3</span> population      <span class="dv">1</span> <span class="dv">1706-20170917-133</span><span class="sc">-</span>C NWHI;pelagic  <span class="fl">0.4</span>;<span class="fl">0.6</span></span>
<span id="cb244-19"><a href="subgroups2.html#cb244-19" tabindex="-1"></a><span class="dv">4</span> population      <span class="dv">1</span> <span class="dv">1706-20170917-133</span><span class="sc">-</span>D NWHI;pelagic  <span class="fl">0.4</span>;<span class="fl">0.6</span></span>
<span id="cb244-20"><a href="subgroups2.html#cb244-20" tabindex="-1"></a><span class="dv">5</span> population      <span class="dv">1</span> <span class="dv">1706-20170917-133</span><span class="sc">-</span>E NWHI;pelagic  <span class="fl">0.4</span>;<span class="fl">0.6</span></span>
<span id="cb244-21"><a href="subgroups2.html#cb244-21" tabindex="-1"></a><span class="dv">6</span> population      <span class="dv">1</span> <span class="dv">1706-20170917-133</span><span class="sc">-</span>F NWHI;pelagic  <span class="fl">0.4</span>;<span class="fl">0.6</span></span></code></pre></div>
<p><strong>Sighting 033</strong> subgroups were automatically placed in the NWHI population, but <a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. (2020)</a> has them in the Pelagic population.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="subgroups2.html#cb245-1" tabindex="-1"></a>sit033 <span class="ot">&lt;-</span> </span>
<span id="cb245-2"><a href="subgroups2.html#cb245-2" tabindex="-1"></a>   <span class="fu">subgroup_edits</span>(<span class="at">cohort=</span><span class="dv">1</span>,</span>
<span id="cb245-3"><a href="subgroups2.html#cb245-3" tabindex="-1"></a>                 <span class="at">sgid =</span> <span class="fu">c</span>(<span class="st">&quot;1706-20170723-033-A&quot;</span>,</span>
<span id="cb245-4"><a href="subgroups2.html#cb245-4" tabindex="-1"></a>                          <span class="st">&quot;1706-20170723-033-B&quot;</span>,</span>
<span id="cb245-5"><a href="subgroups2.html#cb245-5" tabindex="-1"></a>                          <span class="st">&quot;1706-20170723-033-C&quot;</span>,</span>
<span id="cb245-6"><a href="subgroups2.html#cb245-6" tabindex="-1"></a>                          <span class="st">&quot;1706-20170723-033-D&quot;</span>,</span>
<span id="cb245-7"><a href="subgroups2.html#cb245-7" tabindex="-1"></a>                          <span class="st">&quot;1706-20170723-033-E&quot;</span>),</span>
<span id="cb245-8"><a href="subgroups2.html#cb245-8" tabindex="-1"></a>                 <span class="at">population =</span> <span class="st">&#39;pelagic&#39;</span>,</span>
<span id="cb245-9"><a href="subgroups2.html#cb245-9" tabindex="-1"></a>                 <span class="at">pop_prob =</span> <span class="st">&#39;1&#39;</span>)</span>
<span id="cb245-10"><a href="subgroups2.html#cb245-10" tabindex="-1"></a></span>
<span id="cb245-11"><a href="subgroups2.html#cb245-11" tabindex="-1"></a><span class="co"># Check it out</span></span>
<span id="cb245-12"><a href="subgroups2.html#cb245-12" tabindex="-1"></a>sit033</span>
<span id="cb245-13"><a href="subgroups2.html#cb245-13" tabindex="-1"></a>[[<span class="dv">1</span>]]</span>
<span id="cb245-14"><a href="subgroups2.html#cb245-14" tabindex="-1"></a>        edit cohort                sgid population pop_prob</span>
<span id="cb245-15"><a href="subgroups2.html#cb245-15" tabindex="-1"></a><span class="dv">1</span> population      <span class="dv">1</span> <span class="dv">1706-20170723-033</span><span class="sc">-</span>A    pelagic        <span class="dv">1</span></span>
<span id="cb245-16"><a href="subgroups2.html#cb245-16" tabindex="-1"></a><span class="dv">2</span> population      <span class="dv">1</span> <span class="dv">1706-20170723-033</span><span class="sc">-</span>B    pelagic        <span class="dv">1</span></span>
<span id="cb245-17"><a href="subgroups2.html#cb245-17" tabindex="-1"></a><span class="dv">3</span> population      <span class="dv">1</span> <span class="dv">1706-20170723-033</span><span class="sc">-</span>C    pelagic        <span class="dv">1</span></span>
<span id="cb245-18"><a href="subgroups2.html#cb245-18" tabindex="-1"></a><span class="dv">4</span> population      <span class="dv">1</span> <span class="dv">1706-20170723-033</span><span class="sc">-</span>D    pelagic        <span class="dv">1</span></span>
<span id="cb245-19"><a href="subgroups2.html#cb245-19" tabindex="-1"></a><span class="dv">5</span> population      <span class="dv">1</span> <span class="dv">1706-20170723-033</span><span class="sc">-</span>E    pelagic        <span class="dv">1</span></span></code></pre></div>
<p>The same goes for the subgroups in <strong>Sighting 122:</strong></p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="subgroups2.html#cb246-1" tabindex="-1"></a>sit122 <span class="ot">&lt;-</span> </span>
<span id="cb246-2"><a href="subgroups2.html#cb246-2" tabindex="-1"></a>  <span class="fu">subgroup_edits</span>(<span class="at">cohort=</span><span class="dv">1</span>,</span>
<span id="cb246-3"><a href="subgroups2.html#cb246-3" tabindex="-1"></a>                 <span class="at">sgid =</span> <span class="fu">paste0</span>(<span class="st">&quot;1706-20170913-122-&quot;</span>, </span>
<span id="cb246-4"><a href="subgroups2.html#cb246-4" tabindex="-1"></a>                               <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;E&quot;</span>)),</span>
<span id="cb246-5"><a href="subgroups2.html#cb246-5" tabindex="-1"></a>                 <span class="at">population =</span> <span class="st">&#39;pelagic&#39;</span>,</span>
<span id="cb246-6"><a href="subgroups2.html#cb246-6" tabindex="-1"></a>                 <span class="at">pop_prob =</span> <span class="st">&#39;1&#39;</span>)</span></code></pre></div>
<p><strong>Sighting 039</strong> has a subgroup that was in fact seen by the primary observer, according to Bradford et al. (2020):</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="subgroups2.html#cb247-1" tabindex="-1"></a><span class="co"># Sighting 039: ALB says subgroup D observer is valid; LTabundR says no.</span></span>
<span id="cb247-2"><a href="subgroups2.html#cb247-2" tabindex="-1"></a>sit039 <span class="ot">&lt;-</span> </span>
<span id="cb247-3"><a href="subgroups2.html#cb247-3" tabindex="-1"></a>  <span class="fu">subgroup_edits</span>(<span class="at">cohort=</span><span class="dv">1</span>,</span>
<span id="cb247-4"><a href="subgroups2.html#cb247-4" tabindex="-1"></a>                 <span class="at">sgid =</span> <span class="st">&quot;1706-20170727-039-D&quot;</span>,</span>
<span id="cb247-5"><a href="subgroups2.html#cb247-5" tabindex="-1"></a>                 <span class="at">ObsStd =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><strong>Sighting 073</strong> has a subgroup that was in fact seen by the primary observer, according to Bradford et al. (2020):</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="subgroups2.html#cb248-1" tabindex="-1"></a><span class="co"># Sighting 073: ALB says subgroup C observer is valid; LTabundR says no</span></span>
<span id="cb248-2"><a href="subgroups2.html#cb248-2" tabindex="-1"></a>sit073 <span class="ot">&lt;-</span> </span>
<span id="cb248-3"><a href="subgroups2.html#cb248-3" tabindex="-1"></a>  <span class="fu">subgroup_edits</span>(<span class="at">cohort=</span><span class="dv">1</span>,</span>
<span id="cb248-4"><a href="subgroups2.html#cb248-4" tabindex="-1"></a>                 <span class="at">sgid =</span> <span class="st">&quot;1705-20170929-073-C&quot;</span>,</span>
<span id="cb248-5"><a href="subgroups2.html#cb248-5" tabindex="-1"></a>                 <span class="at">ObsStd =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>We can now re-process the subgroup data while applying these edits:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="subgroups2.html#cb249-1" tabindex="-1"></a>cruzi <span class="ot">&lt;-</span> <span class="fu">process_subgroups</span>(cruzi, </span>
<span id="cb249-2"><a href="subgroups2.html#cb249-2" tabindex="-1"></a>                           <span class="at">edits=</span><span class="fu">list</span>(pops,</span>
<span id="cb249-3"><a href="subgroups2.html#cb249-3" tabindex="-1"></a>                                      sit133,</span>
<span id="cb249-4"><a href="subgroups2.html#cb249-4" tabindex="-1"></a>                                      sit033,</span>
<span id="cb249-5"><a href="subgroups2.html#cb249-5" tabindex="-1"></a>                                      sit122,</span>
<span id="cb249-6"><a href="subgroups2.html#cb249-6" tabindex="-1"></a>                                      sit039,</span>
<span id="cb249-7"><a href="subgroups2.html#cb249-7" tabindex="-1"></a>                                      sit073), </span>
<span id="cb249-8"><a href="subgroups2.html#cb249-8" tabindex="-1"></a>                           <span class="at">verbose=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>Inspect the result:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="subgroups2.html#cb250-1" tabindex="-1"></a>cruzi<span class="sc">$</span>cohorts<span class="sc">$</span>all<span class="sc">$</span>subgroups<span class="sc">$</span>events<span class="sc">$</span>population <span class="sc">%&gt;%</span> table</span>
<span id="cb250-2"><a href="subgroups2.html#cb250-2" tabindex="-1"></a>.</span>
<span id="cb250-3"><a href="subgroups2.html#cb250-3" tabindex="-1"></a>         MHI         NWHI NWHI;pelagic      pelagic </span>
<span id="cb250-4"><a href="subgroups2.html#cb250-4" tabindex="-1"></a>           <span class="dv">1</span>            <span class="dv">1</span>            <span class="dv">9</span>           <span class="dv">37</span> </span>
<span id="cb250-5"><a href="subgroups2.html#cb250-5" tabindex="-1"></a></span>
<span id="cb250-6"><a href="subgroups2.html#cb250-6" tabindex="-1"></a>cruzi<span class="sc">$</span>cohorts<span class="sc">$</span>all<span class="sc">$</span>subgroups<span class="sc">$</span>events<span class="sc">$</span>pop_prob <span class="sc">%&gt;%</span> table</span>
<span id="cb250-7"><a href="subgroups2.html#cb250-7" tabindex="-1"></a>.</span>
<span id="cb250-8"><a href="subgroups2.html#cb250-8" tabindex="-1"></a><span class="fl">0.4</span>;<span class="fl">0.6</span>       <span class="dv">1</span> </span>
<span id="cb250-9"><a href="subgroups2.html#cb250-9" tabindex="-1"></a>      <span class="dv">9</span>      <span class="dv">39</span> </span></code></pre></div>
<p>Now we are (finally!) ready to prepare segments and sightings for estimating the encounter rate.</p>
<p>From this filtered <code>cruz</code> object, we will isolate the segments data:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="subgroups2.html#cb251-1" tabindex="-1"></a>density_segments <span class="ot">&lt;-</span> cruzi<span class="sc">$</span>cohorts<span class="sc">$</span>all<span class="sc">$</span>segments</span></code></pre></div>
</div>
<div id="density_das" class="section level3 unnumbered hasAnchor">
<h3><code>density_das</code><a href="subgroups2.html#density_das" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is the complete survey data corresponding to the above segments. These data will be used to determine the proportion of survey effort occurring in each Beaufort sea state, which is needed to compute the estimate of weighted mean <em>g(0)</em> from the <em>Rg(0)</em> values.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="subgroups2.html#cb252-1" tabindex="-1"></a>density_das <span class="ot">&lt;-</span> cruzi<span class="sc">$</span>cohorts<span class="sc">$</span>all<span class="sc">$</span>das</span></code></pre></div>
</div>
<div id="density_sightings" class="section level3 unnumbered hasAnchor">
<h3><code>density_sightings</code><a href="subgroups2.html#density_sightings" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>These are the encounters to use in density/abundance estimation. In <a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. (2020)</a>, these were the Phase 1 detections of false killer whale subgroups within a given region and year. For this demonstration our focus is the Hawaiian EEZ in 2017. Criteria are: <code>OnEffort</code> is <code>TRUE</code>, <code>EffType</code> is <code>"S"</code>, within truncation disance, no abeam sightings, primary observer, Pelagic and NWHI populations only. No filtering is applied to these sightings within the <code>lta_subgroups()</code> function, so make sure only the sightings you wish to use are included and nothing more.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="subgroups2.html#cb253-1" tabindex="-1"></a>density_sightings  <span class="ot">&lt;-</span></span>
<span id="cb253-2"><a href="subgroups2.html#cb253-2" tabindex="-1"></a>  cruzi<span class="sc">$</span>cohorts<span class="sc">$</span>all<span class="sc">$</span>subgroups<span class="sc">$</span>subgroups <span class="sc">%&gt;%</span></span>
<span id="cb253-3"><a href="subgroups2.html#cb253-3" tabindex="-1"></a>  <span class="fu">filter</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(DateTime) <span class="sc">==</span> <span class="dv">2017</span>,</span>
<span id="cb253-4"><a href="subgroups2.html#cb253-4" tabindex="-1"></a>         EffType <span class="sc">==</span> <span class="st">&#39;S&#39;</span>,</span>
<span id="cb253-5"><a href="subgroups2.html#cb253-5" tabindex="-1"></a>         OnEffort <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb253-6"><a href="subgroups2.html#cb253-6" tabindex="-1"></a>         PerpDist <span class="sc">&lt;=</span> truncation_distance,</span>
<span id="cb253-7"><a href="subgroups2.html#cb253-7" tabindex="-1"></a>         Angle <span class="sc">&lt;=</span> <span class="dv">90</span>,</span>
<span id="cb253-8"><a href="subgroups2.html#cb253-8" tabindex="-1"></a>         ObsStd <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb253-9"><a href="subgroups2.html#cb253-9" tabindex="-1"></a>         Species <span class="sc">==</span> <span class="st">&#39;033&#39;</span>,</span>
<span id="cb253-10"><a href="subgroups2.html#cb253-10" tabindex="-1"></a>         Phase <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb253-11"><a href="subgroups2.html#cb253-11" tabindex="-1"></a>         population <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;pelagic&#39;</span>, <span class="st">&#39;NWHI;pelagic&#39;</span>, <span class="st">&#39;NWHI&#39;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="subgroups2.html#cb254-1" tabindex="-1"></a><span class="co"># Sample size</span></span>
<span id="cb254-2"><a href="subgroups2.html#cb254-2" tabindex="-1"></a>density_sightings <span class="sc">%&gt;%</span> nrow</span>
<span id="cb254-3"><a href="subgroups2.html#cb254-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">26</span></span></code></pre></div>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="subgroups2.html#cb255-1" tabindex="-1"></a><span class="co"># Subgroups from each sighting</span></span>
<span id="cb255-2"><a href="subgroups2.html#cb255-2" tabindex="-1"></a>density_sightings <span class="sc">%&gt;%</span> </span>
<span id="cb255-3"><a href="subgroups2.html#cb255-3" tabindex="-1"></a>  <span class="fu">select</span>(Cruise, Date, SightNo, population, pop_prob) <span class="sc">%&gt;%</span> </span>
<span id="cb255-4"><a href="subgroups2.html#cb255-4" tabindex="-1"></a>  <span class="fu">arrange</span>(Date) <span class="sc">%&gt;%</span> </span>
<span id="cb255-5"><a href="subgroups2.html#cb255-5" tabindex="-1"></a>  <span class="fu">group_by</span>(Cruise, Date, SightNo, population, pop_prob) <span class="sc">%&gt;%</span> </span>
<span id="cb255-6"><a href="subgroups2.html#cb255-6" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>()) <span class="co">#%&gt;% pull(n) %&gt;% sum()</span></span>
<span id="cb255-7"><a href="subgroups2.html#cb255-7" tabindex="-1"></a><span class="co"># A tibble: 7 × 6</span></span>
<span id="cb255-8"><a href="subgroups2.html#cb255-8" tabindex="-1"></a><span class="co"># Groups:   Cruise, Date, SightNo, population [7]</span></span>
<span id="cb255-9"><a href="subgroups2.html#cb255-9" tabindex="-1"></a>  Cruise Date       SightNo population   pop_prob     n</span>
<span id="cb255-10"><a href="subgroups2.html#cb255-10" tabindex="-1"></a>   <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>      <span class="er">&lt;</span>chr<span class="sc">&gt;</span>   <span class="er">&lt;</span>chr<span class="sc">&gt;</span>        <span class="er">&lt;</span>chr<span class="sc">&gt;</span>    <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb255-11"><a href="subgroups2.html#cb255-11" tabindex="-1"></a><span class="dv">1</span>   <span class="dv">1705</span> <span class="dv">2017-09-21</span> <span class="dv">064</span>     pelagic      <span class="dv">1</span>            <span class="dv">2</span></span>
<span id="cb255-12"><a href="subgroups2.html#cb255-12" tabindex="-1"></a><span class="dv">2</span>   <span class="dv">1705</span> <span class="dv">2017-09-29</span> <span class="dv">073</span>     pelagic      <span class="dv">1</span>            <span class="dv">6</span></span>
<span id="cb255-13"><a href="subgroups2.html#cb255-13" tabindex="-1"></a><span class="dv">3</span>   <span class="dv">1706</span> <span class="dv">2017-07-23</span> <span class="dv">033</span>     pelagic      <span class="dv">1</span>            <span class="dv">4</span></span>
<span id="cb255-14"><a href="subgroups2.html#cb255-14" tabindex="-1"></a><span class="dv">4</span>   <span class="dv">1706</span> <span class="dv">2017-07-27</span> <span class="dv">039</span>     pelagic      <span class="dv">1</span>            <span class="dv">4</span></span>
<span id="cb255-15"><a href="subgroups2.html#cb255-15" tabindex="-1"></a><span class="dv">5</span>   <span class="dv">1706</span> <span class="dv">2017-09-13</span> <span class="dv">122</span>     pelagic      <span class="dv">1</span>            <span class="dv">3</span></span>
<span id="cb255-16"><a href="subgroups2.html#cb255-16" tabindex="-1"></a><span class="dv">6</span>   <span class="dv">1706</span> <span class="dv">2017-09-17</span> <span class="dv">133</span>     NWHI;pelagic <span class="fl">0.4</span>;<span class="fl">0.6</span>      <span class="dv">6</span></span>
<span id="cb255-17"><a href="subgroups2.html#cb255-17" tabindex="-1"></a><span class="dv">7</span>   <span class="dv">1706</span> <span class="dv">2017-09-20</span> <span class="dv">141</span>     pelagic      <span class="dv">1</span>            <span class="dv">1</span></span></code></pre></div>
<p><a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. (2020)</a> had a sample size of 23.6 for the pelagic stock in the Hawaiian EEZ. The fraction comes from the fact that one sighting (<code>SightNo</code> 133, which has 6 subgroups) has a prorated population designation, with a 0.6 probability that it belongs to the pelagic stock and a 0.4 probability that is belongs to the Northwest Hawaiian Islands (NWHI) stock. The 3.6 comes from <code>0.6 of the sighting's</code>6` subgroups.</p>
</div>
<div id="abundance_area" class="section level3 unnumbered hasAnchor">
<h3><code>abundance_area</code><a href="subgroups2.html#abundance_area" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is the area, in square km, of the region of interest. The density estimate will be scaled by this area.</p>
<p>We have two options for finding this area. The first is to draw the area from our <code>cohort$strata</code> slot:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="subgroups2.html#cb256-1" tabindex="-1"></a>cruz<span class="sc">$</span>strata<span class="sc">$</span>area[cruz<span class="sc">$</span>strata<span class="sc">$</span>stratum <span class="sc">==</span> <span class="st">&#39;HI_EEZ&#39;</span>]</span>
<span id="cb256-2"><a href="subgroups2.html#cb256-2" tabindex="-1"></a><span class="dv">2474596</span> [km<span class="sc">^</span><span class="dv">2</span>]</span></code></pre></div>
<p>The second is to calculate it ourselves using the <code>LTabundR</code> function <code>strata_area()</code>. This second option will be useful if your study area is a complicated combination/substraction of multiple geostrata.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="subgroups2.html#cb257-1" tabindex="-1"></a><span class="fu">data</span>(strata_cnp)</span>
<span id="cb257-2"><a href="subgroups2.html#cb257-2" tabindex="-1"></a></span>
<span id="cb257-3"><a href="subgroups2.html#cb257-3" tabindex="-1"></a>abundance_area <span class="ot">&lt;-</span> </span>
<span id="cb257-4"><a href="subgroups2.html#cb257-4" tabindex="-1"></a>  <span class="fu">strata_area</span>(<span class="at">strata_all =</span> strata_cnp,</span>
<span id="cb257-5"><a href="subgroups2.html#cb257-5" tabindex="-1"></a>              <span class="at">strata_keep =</span> <span class="st">&#39;HI_EEZ&#39;</span>)<span class="sc">$</span>km2</span></code></pre></div>
<p><img src="figures/unnamed-chunk-317-1.png" width="672" /></p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="subgroups2.html#cb258-1" tabindex="-1"></a></span>
<span id="cb258-2"><a href="subgroups2.html#cb258-2" tabindex="-1"></a>abundance_area</span>
<span id="cb258-3"><a href="subgroups2.html#cb258-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">2474596</span></span></code></pre></div>
</div>
<div id="remaining-inputs" class="section level3 unnumbered hasAnchor">
<h3>Remaining inputs<a href="subgroups2.html#remaining-inputs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong><code>iterations</code></strong>: Number of iterations to use in the various CV bootstrapping procedures occurring throughout this function, specifically: effective strip width CV estimation, subgroup size CV estimation, weighted <em>g(0)</em> CV estimation, and encounter rate estimation.</p>
<p><strong><code>density_bootstraps</code></strong>: Number of bootstrap iterations to use for the CV estimate of density and abundance specifically. This input allows this final step to use a different (typically larger) iteration size than the iterations input above.</p>
<p><strong><code>output_dir</code></strong>: The path in which results RData files should be stored. If left ““, the current working directory will be used.</p>
<p><strong><code>toplot</code></strong>: A Boolean, with default FALSE, indicating whether to plot various aspects of the analysis.</p>
<p><strong><code>verbose</code></strong>: A Boolean, with default TRUE, indicating whether to print status updates to the Console.</p>
</div>
</div>
<div id="running-lta_subgroup" class="section level2 unnumbered hasAnchor">
<h2>Running <code>lta_subgroup()</code><a href="subgroups2.html#running-lta_subgroup" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To demonstrate how the <code>lta_subgroup()</code> function works, we use it here without re-modling the Relative <em>g(0)</em> parameters.</p>
<p>We first estimate parameters for the Hawaii EEZ stratum. Our main interest there is the pelagic stock, but we need to include both populations (pelagic <em>and</em> NWHI), since one of the sightings has a prorated population assignment. After running <code>lta_subgroup()</code>, we will only focus on the results for the pelagic stock.</p>
<p>We then estimate parameters for the NWHI stratum, then focus on the results for the NWHI stock.</p>
<div id="hawaii-eez-stratum" class="section level3 unnumbered hasAnchor">
<h3>Hawaii EEZ stratum<a href="subgroups2.html#hawaii-eez-stratum" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="subgroups2.html#cb259-1" tabindex="-1"></a>results_eez <span class="ot">&lt;-</span> </span>
<span id="cb259-2"><a href="subgroups2.html#cb259-2" tabindex="-1"></a>  <span class="fu">lta_subgroup</span>(<span class="at">df_sits =</span> df_sits,</span>
<span id="cb259-3"><a href="subgroups2.html#cb259-3" tabindex="-1"></a>               <span class="at">truncation_distance =</span> truncation_distance,</span>
<span id="cb259-4"><a href="subgroups2.html#cb259-4" tabindex="-1"></a>               <span class="at">ss =</span> ss,</span>
<span id="cb259-5"><a href="subgroups2.html#cb259-5" tabindex="-1"></a>               <span class="at">density_segments =</span> density_segments,</span>
<span id="cb259-6"><a href="subgroups2.html#cb259-6" tabindex="-1"></a>               <span class="at">density_das =</span> density_das,</span>
<span id="cb259-7"><a href="subgroups2.html#cb259-7" tabindex="-1"></a>               <span class="at">density_sightings =</span> density_sightings,</span>
<span id="cb259-8"><a href="subgroups2.html#cb259-8" tabindex="-1"></a>               <span class="at">Rg0 =</span> Rg0,</span>
<span id="cb259-9"><a href="subgroups2.html#cb259-9" tabindex="-1"></a>               <span class="at">abundance_area =</span> abundance_area,</span>
<span id="cb259-10"><a href="subgroups2.html#cb259-10" tabindex="-1"></a>               <span class="at">iterations =</span> <span class="dv">1000</span>,</span>
<span id="cb259-11"><a href="subgroups2.html#cb259-11" tabindex="-1"></a>               <span class="at">output_dir =</span> <span class="st">&#39;subgroup_eez/&#39;</span>,</span>
<span id="cb259-12"><a href="subgroups2.html#cb259-12" tabindex="-1"></a>               <span class="at">toplot =</span> <span class="cn">TRUE</span>,</span>
<span id="cb259-13"><a href="subgroups2.html#cb259-13" tabindex="-1"></a>               <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb259-14"><a href="subgroups2.html#cb259-14" tabindex="-1"></a>               <span class="at">density_bootstraps =</span> <span class="dv">10000</span>)</span></code></pre></div>
</div>
<div id="northwest-hawaiian-islands-stratum" class="section level3 unnumbered hasAnchor">
<h3>Northwest Hawaiian Islands stratum<a href="subgroups2.html#northwest-hawaiian-islands-stratum" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To re-run this for the other geostratum of interest in the <a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. (2020)</a>, the Northwest Hawaiian Islands (NWHI), we make the following adjustments:</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="subgroups2.html#cb260-1" tabindex="-1"></a><span class="co"># Filter DAS to rows within the NWHi stratum</span></span>
<span id="cb260-2"><a href="subgroups2.html#cb260-2" tabindex="-1"></a>das_nwhi <span class="ot">&lt;-</span> density_das <span class="sc">%&gt;%</span> <span class="fu">filter</span>(stratum_NWHI <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb260-3"><a href="subgroups2.html#cb260-3" tabindex="-1"></a></span>
<span id="cb260-4"><a href="subgroups2.html#cb260-4" tabindex="-1"></a><span class="co"># Use these rows to get segment IDs</span></span>
<span id="cb260-5"><a href="subgroups2.html#cb260-5" tabindex="-1"></a>nwhi_segment_ids <span class="ot">&lt;-</span> das_nwhi<span class="sc">$</span>seg_id <span class="sc">%&gt;%</span> unique</span>
<span id="cb260-6"><a href="subgroups2.html#cb260-6" tabindex="-1"></a></span>
<span id="cb260-7"><a href="subgroups2.html#cb260-7" tabindex="-1"></a><span class="co"># Filter segments to those segment IDs</span></span>
<span id="cb260-8"><a href="subgroups2.html#cb260-8" tabindex="-1"></a>segments_nwhi <span class="ot">&lt;-</span> density_segments <span class="sc">%&gt;%</span> <span class="fu">filter</span>(seg_id <span class="sc">%in%</span> nwhi_segment_ids)</span>
<span id="cb260-9"><a href="subgroups2.html#cb260-9" tabindex="-1"></a></span>
<span id="cb260-10"><a href="subgroups2.html#cb260-10" tabindex="-1"></a><span class="co"># Filter sightings to those within NWHI stratum</span></span>
<span id="cb260-11"><a href="subgroups2.html#cb260-11" tabindex="-1"></a>sightings_nwhi <span class="ot">&lt;-</span> density_sightings <span class="sc">%&gt;%</span> <span class="fu">filter</span>(stratum_NWHI <span class="sc">==</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="subgroups2.html#cb261-1" tabindex="-1"></a><span class="co"># Update abundance area</span></span>
<span id="cb261-2"><a href="subgroups2.html#cb261-2" tabindex="-1"></a>area_nwhi <span class="ot">&lt;-</span> <span class="fu">strata_area</span>(<span class="at">strata_all =</span> strata_cnp,</span>
<span id="cb261-3"><a href="subgroups2.html#cb261-3" tabindex="-1"></a>                         <span class="at">strata_keep =</span> <span class="st">&#39;NWHI&#39;</span>)<span class="sc">$</span>km2</span>
<span id="cb261-4"><a href="subgroups2.html#cb261-4" tabindex="-1"></a></span>
<span id="cb261-5"><a href="subgroups2.html#cb261-5" tabindex="-1"></a>area_nwhi</span></code></pre></div>
<p>Now run <code>lta_subgroup()</code>:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="subgroups2.html#cb262-1" tabindex="-1"></a>results_nwhi <span class="ot">&lt;-</span> </span>
<span id="cb262-2"><a href="subgroups2.html#cb262-2" tabindex="-1"></a>  <span class="fu">lta_subgroup</span>(<span class="at">df_sits =</span> df_sits,</span>
<span id="cb262-3"><a href="subgroups2.html#cb262-3" tabindex="-1"></a>               <span class="at">truncation_distance =</span> truncation_distance,</span>
<span id="cb262-4"><a href="subgroups2.html#cb262-4" tabindex="-1"></a>               <span class="at">ss =</span> ss,</span>
<span id="cb262-5"><a href="subgroups2.html#cb262-5" tabindex="-1"></a>               <span class="at">density_segments =</span> segments_nwhi,</span>
<span id="cb262-6"><a href="subgroups2.html#cb262-6" tabindex="-1"></a>               <span class="at">density_das =</span> das_nwhi,</span>
<span id="cb262-7"><a href="subgroups2.html#cb262-7" tabindex="-1"></a>               <span class="at">density_sightings =</span> sightings_nwhi,</span>
<span id="cb262-8"><a href="subgroups2.html#cb262-8" tabindex="-1"></a>               <span class="at">Rg0 =</span> Rg0,</span>
<span id="cb262-9"><a href="subgroups2.html#cb262-9" tabindex="-1"></a>               <span class="at">abundance_area =</span> area_nwhi,</span>
<span id="cb262-10"><a href="subgroups2.html#cb262-10" tabindex="-1"></a>               <span class="at">iterations =</span> <span class="dv">1000</span>,</span>
<span id="cb262-11"><a href="subgroups2.html#cb262-11" tabindex="-1"></a>               <span class="at">output_dir =</span> <span class="st">&#39;subgroup_nwhi/&#39;</span>,</span>
<span id="cb262-12"><a href="subgroups2.html#cb262-12" tabindex="-1"></a>               <span class="at">toplot =</span> <span class="cn">TRUE</span>,</span>
<span id="cb262-13"><a href="subgroups2.html#cb262-13" tabindex="-1"></a>               <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb262-14"><a href="subgroups2.html#cb262-14" tabindex="-1"></a>               <span class="at">density_bootstraps =</span> <span class="dv">10000</span>)</span></code></pre></div>
</div>
</div>
<div id="outputs-1" class="section level2 unnumbered hasAnchor">
<h2>Outputs<a href="subgroups2.html#outputs-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The function returns a <code>list</code> with many slots:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="subgroups2.html#cb263-1" tabindex="-1"></a>results_eez <span class="sc">%&gt;%</span> names</span>
<span id="cb263-2"><a href="subgroups2.html#cb263-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;estimate&quot;</span>           <span class="st">&quot;g0_details&quot;</span>         <span class="st">&quot;df&quot;</span>                </span>
<span id="cb263-3"><a href="subgroups2.html#cb263-3" tabindex="-1"></a>[<span class="dv">4</span>] <span class="st">&quot;bootstraps&quot;</span>         <span class="st">&quot;iterations&quot;</span>         <span class="st">&quot;density_bootstraps&quot;</span></span>
<span id="cb263-4"><a href="subgroups2.html#cb263-4" tabindex="-1"></a>[<span class="dv">7</span>] <span class="st">&quot;bft&quot;</span>               </span></code></pre></div>
<p>The first slot holds the most relevant results:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="subgroups2.html#cb264-1" tabindex="-1"></a><span class="co"># Hawaii EEZ</span></span>
<span id="cb264-2"><a href="subgroups2.html#cb264-2" tabindex="-1"></a>results_eez<span class="sc">$</span>estimate <span class="sc">%&gt;%</span> <span class="fu">filter</span>(population <span class="sc">==</span> <span class="st">&#39;pelagic&#39;</span>)</span>
<span id="cb264-3"><a href="subgroups2.html#cb264-3" tabindex="-1"></a>  population        L n_segments   g0 g0_cv     ESW    ESW_CV    group</span>
<span id="cb264-4"><a href="subgroups2.html#cb264-4" tabindex="-1"></a><span class="dv">1</span>    pelagic <span class="fl">15863.76</span>        <span class="dv">131</span> <span class="fl">0.36</span> <span class="fl">0.323</span> <span class="fl">2.32655</span> <span class="fl">0.1024722</span> <span class="fl">2.370472</span></span>
<span id="cb264-5"><a href="subgroups2.html#cb264-5" tabindex="-1"></a>   group_sd   group_CV    n          ER           D        CV        D_L95</span>
<span id="cb264-6"><a href="subgroups2.html#cb264-6" tabindex="-1"></a><span class="dv">1</span> <span class="fl">0.1468646</span> <span class="fl">0.06195582</span> <span class="fl">23.6</span> <span class="fl">0.001487667</span> <span class="fl">0.002105212</span> <span class="fl">0.7129675</span> <span class="fl">0.0007559698</span></span>
<span id="cb264-7"><a href="subgroups2.html#cb264-7" tabindex="-1"></a>        D_U95    Area    N N_L95 N_U95</span>
<span id="cb264-8"><a href="subgroups2.html#cb264-8" tabindex="-1"></a><span class="dv">1</span> <span class="fl">0.008022891</span> <span class="dv">2474596</span> <span class="dv">5210</span>  <span class="dv">1871</span> <span class="dv">19853</span></span>
<span id="cb264-9"><a href="subgroups2.html#cb264-9" tabindex="-1"></a></span>
<span id="cb264-10"><a href="subgroups2.html#cb264-10" tabindex="-1"></a><span class="co"># NWHI</span></span>
<span id="cb264-11"><a href="subgroups2.html#cb264-11" tabindex="-1"></a>results_nwhi<span class="sc">$</span>estimate <span class="sc">%&gt;%</span> <span class="fu">filter</span>(population <span class="sc">==</span> <span class="st">&#39;NWHI&#39;</span>)</span>
<span id="cb264-12"><a href="subgroups2.html#cb264-12" tabindex="-1"></a>  population        L n_segments    g0 g0_cv     ESW   ESW_CV    group</span>
<span id="cb264-13"><a href="subgroups2.html#cb264-13" tabindex="-1"></a><span class="dv">1</span>       NWHI <span class="fl">2962.834</span>         <span class="dv">26</span> <span class="fl">0.386</span> <span class="fl">0.292</span> <span class="fl">2.32655</span> <span class="fl">0.101002</span> <span class="fl">2.370472</span></span>
<span id="cb264-14"><a href="subgroups2.html#cb264-14" tabindex="-1"></a>   group_sd   group_CV   n           ER           D       CV D_L95     D_U95</span>
<span id="cb264-15"><a href="subgroups2.html#cb264-15" tabindex="-1"></a><span class="dv">1</span> <span class="fl">0.1455589</span> <span class="fl">0.06140501</span> <span class="fl">2.4</span> <span class="fl">0.0008100354</span> <span class="fl">0.001069077</span> <span class="fl">2.250659</span>     <span class="dv">0</span> <span class="fl">0.0298586</span></span>
<span id="cb264-16"><a href="subgroups2.html#cb264-16" tabindex="-1"></a>      Area   N N_L95 N_U95</span>
<span id="cb264-17"><a href="subgroups2.html#cb264-17" tabindex="-1"></a><span class="dv">1</span> <span class="fl">449375.6</span> <span class="dv">480</span>     <span class="dv">0</span> <span class="dv">13418</span></span></code></pre></div>
<p>(Note density is provided in units of individuals per square km, not individuals per 100 square km as in <a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. 2020</a>.).</p>
<p>The <code>bft</code> slot shows the proportion of effort in each Beaufort sea state:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="subgroups2.html#cb265-1" tabindex="-1"></a>results_eez<span class="sc">$</span>bft</span>
<span id="cb265-2"><a href="subgroups2.html#cb265-2" tabindex="-1"></a><span class="co"># A tibble: 7 × 3</span></span>
<span id="cb265-3"><a href="subgroups2.html#cb265-3" tabindex="-1"></a>   bftr     km     prop</span>
<span id="cb265-4"><a href="subgroups2.html#cb265-4" tabindex="-1"></a>  <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb265-5"><a href="subgroups2.html#cb265-5" tabindex="-1"></a><span class="dv">1</span>     <span class="dv">0</span>   <span class="fl">12.6</span> <span class="fl">0.000775</span></span>
<span id="cb265-6"><a href="subgroups2.html#cb265-6" tabindex="-1"></a><span class="dv">2</span>     <span class="dv">1</span>  <span class="fl">154.</span>  <span class="fl">0.00943</span> </span>
<span id="cb265-7"><a href="subgroups2.html#cb265-7" tabindex="-1"></a><span class="dv">3</span>     <span class="dv">2</span>  <span class="fl">692.</span>  <span class="fl">0.0425</span>  </span>
<span id="cb265-8"><a href="subgroups2.html#cb265-8" tabindex="-1"></a><span class="dv">4</span>     <span class="dv">3</span> <span class="fl">1993.</span>  <span class="fl">0.122</span>   </span>
<span id="cb265-9"><a href="subgroups2.html#cb265-9" tabindex="-1"></a><span class="dv">5</span>     <span class="dv">4</span> <span class="fl">5141.</span>  <span class="fl">0.316</span>   </span>
<span id="cb265-10"><a href="subgroups2.html#cb265-10" tabindex="-1"></a><span class="dv">6</span>     <span class="dv">5</span> <span class="fl">5603.</span>  <span class="fl">0.344</span>   </span>
<span id="cb265-11"><a href="subgroups2.html#cb265-11" tabindex="-1"></a><span class="dv">7</span>     <span class="dv">6</span> <span class="fl">2687.</span>  <span class="fl">0.165</span>   </span>
<span id="cb265-12"><a href="subgroups2.html#cb265-12" tabindex="-1"></a></span>
<span id="cb265-13"><a href="subgroups2.html#cb265-13" tabindex="-1"></a>results_nwhi<span class="sc">$</span>bft</span>
<span id="cb265-14"><a href="subgroups2.html#cb265-14" tabindex="-1"></a><span class="co"># A tibble: 7 × 3</span></span>
<span id="cb265-15"><a href="subgroups2.html#cb265-15" tabindex="-1"></a>   bftr    km    prop</span>
<span id="cb265-16"><a href="subgroups2.html#cb265-16" tabindex="-1"></a>  <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb265-17"><a href="subgroups2.html#cb265-17" tabindex="-1"></a><span class="dv">1</span>     <span class="dv">0</span>  <span class="fl">12.6</span> <span class="fl">0.00421</span></span>
<span id="cb265-18"><a href="subgroups2.html#cb265-18" tabindex="-1"></a><span class="dv">2</span>     <span class="dv">1</span>  <span class="fl">65.5</span> <span class="fl">0.0219</span> </span>
<span id="cb265-19"><a href="subgroups2.html#cb265-19" tabindex="-1"></a><span class="dv">3</span>     <span class="dv">2</span> <span class="fl">230.</span>  <span class="fl">0.0767</span> </span>
<span id="cb265-20"><a href="subgroups2.html#cb265-20" tabindex="-1"></a><span class="dv">4</span>     <span class="dv">3</span> <span class="fl">417.</span>  <span class="fl">0.139</span>  </span>
<span id="cb265-21"><a href="subgroups2.html#cb265-21" tabindex="-1"></a><span class="dv">5</span>     <span class="dv">4</span> <span class="fl">870.</span>  <span class="fl">0.291</span>  </span>
<span id="cb265-22"><a href="subgroups2.html#cb265-22" tabindex="-1"></a><span class="dv">6</span>     <span class="dv">5</span> <span class="fl">905.</span>  <span class="fl">0.302</span>  </span>
<span id="cb265-23"><a href="subgroups2.html#cb265-23" tabindex="-1"></a><span class="dv">7</span>     <span class="dv">6</span> <span class="fl">494.</span>  <span class="fl">0.165</span>  </span></code></pre></div>
<p>The <code>g0_details</code> slot includes the results from the <code>g0_model()</code> and <code>g0_weighted()</code> functions called internally by <code>lta_subgroup()</code> (or alternatively, it simply returns the values manually supplied in the <code>Rg0</code> input`. See those functions’ documentation pages for details.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="subgroups2.html#cb266-1" tabindex="-1"></a>results_eez<span class="sc">$</span>g0_details</span>
<span id="cb266-2"><a href="subgroups2.html#cb266-2" tabindex="-1"></a><span class="sc">$</span>summary</span>
<span id="cb266-3"><a href="subgroups2.html#cb266-3" tabindex="-1"></a>  bft  Rg0 Rg0_CV</span>
<span id="cb266-4"><a href="subgroups2.html#cb266-4" tabindex="-1"></a><span class="dv">1</span>   <span class="dv">0</span> <span class="fl">1.00</span>   <span class="fl">0.00</span></span>
<span id="cb266-5"><a href="subgroups2.html#cb266-5" tabindex="-1"></a><span class="dv">2</span>   <span class="dv">1</span> <span class="fl">1.00</span>   <span class="fl">0.00</span></span>
<span id="cb266-6"><a href="subgroups2.html#cb266-6" tabindex="-1"></a><span class="dv">3</span>   <span class="dv">2</span> <span class="fl">0.72</span>   <span class="fl">0.11</span></span>
<span id="cb266-7"><a href="subgroups2.html#cb266-7" tabindex="-1"></a><span class="dv">4</span>   <span class="dv">3</span> <span class="fl">0.51</span>   <span class="fl">0.22</span></span>
<span id="cb266-8"><a href="subgroups2.html#cb266-8" tabindex="-1"></a><span class="dv">5</span>   <span class="dv">4</span> <span class="fl">0.37</span>   <span class="fl">0.34</span></span>
<span id="cb266-9"><a href="subgroups2.html#cb266-9" tabindex="-1"></a><span class="dv">6</span>   <span class="dv">5</span> <span class="fl">0.26</span>   <span class="fl">0.46</span></span>
<span id="cb266-10"><a href="subgroups2.html#cb266-10" tabindex="-1"></a><span class="dv">7</span>   <span class="dv">6</span> <span class="fl">0.19</span>   <span class="fl">0.59</span></span></code></pre></div>
<p>The <code>df</code> slot includes details of the detection function fit. See the documentation for <code>df_plot()</code> for details.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="subgroups2.html#cb267-1" tabindex="-1"></a>results_eez<span class="sc">$</span>df <span class="sc">%&gt;%</span> names</span>
<span id="cb267-2"><a href="subgroups2.html#cb267-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;best_models&quot;</span>  <span class="st">&quot;all_models&quot;</span>   <span class="st">&quot;best_objects&quot;</span> <span class="st">&quot;sightings&quot;</span>   </span></code></pre></div>
<p>The <code>bootstraps</code> slot has the bootstrapped values for various parameters, in case they are useful for troubleshooting, subsequent analyses, and/or plotting:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="subgroups2.html#cb268-1" tabindex="-1"></a>results_eez<span class="sc">$</span>bootstraps <span class="sc">%&gt;%</span> names</span>
<span id="cb268-2"><a href="subgroups2.html#cb268-2" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;i&quot;</span>          <span class="st">&quot;population&quot;</span> <span class="st">&quot;n&quot;</span>          <span class="st">&quot;L&quot;</span>          <span class="st">&quot;er&quot;</span>        </span>
<span id="cb268-3"><a href="subgroups2.html#cb268-3" tabindex="-1"></a> [<span class="dv">6</span>] <span class="st">&quot;ss&quot;</span>         <span class="st">&quot;esw&quot;</span>        <span class="st">&quot;g0&quot;</span>         <span class="st">&quot;D&quot;</span>          <span class="st">&quot;N&quot;</span>         </span></code></pre></div>
<p>Note that there are bootstrap rows for each population:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="subgroups2.html#cb269-1" tabindex="-1"></a>results_eez<span class="sc">$</span>bootstraps <span class="sc">%&gt;%</span> nrow</span>
<span id="cb269-2"><a href="subgroups2.html#cb269-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">20000</span></span>
<span id="cb269-3"><a href="subgroups2.html#cb269-3" tabindex="-1"></a></span>
<span id="cb269-4"><a href="subgroups2.html#cb269-4" tabindex="-1"></a>results_eez<span class="sc">$</span>bootstraps <span class="sc">%&gt;%</span> head</span>
<span id="cb269-5"><a href="subgroups2.html#cb269-5" tabindex="-1"></a>      i population  n        L           er       ss      esw        g0</span>
<span id="cb269-6"><a href="subgroups2.html#cb269-6" tabindex="-1"></a><span class="dv">376</span> <span class="dv">376</span>    pelagic <span class="dv">23</span> <span class="fl">16202.62</span> <span class="fl">0.0014195236</span> <span class="fl">2.418583</span> <span class="fl">2.420691</span> <span class="fl">0.2492111</span></span>
<span id="cb269-7"><a href="subgroups2.html#cb269-7" tabindex="-1"></a><span class="dv">59</span>   <span class="dv">59</span>    pelagic <span class="dv">37</span> <span class="fl">16752.03</span> <span class="fl">0.0022086872</span> <span class="fl">2.171024</span> <span class="fl">2.382842</span> <span class="fl">0.4525880</span></span>
<span id="cb269-8"><a href="subgroups2.html#cb269-8" tabindex="-1"></a><span class="dv">343</span> <span class="dv">343</span>    pelagic <span class="dv">11</span> <span class="fl">15682.35</span> <span class="fl">0.0007014254</span> <span class="fl">2.390157</span> <span class="fl">2.150423</span> <span class="fl">0.4317058</span></span>
<span id="cb269-9"><a href="subgroups2.html#cb269-9" tabindex="-1"></a><span class="dv">469</span> <span class="dv">469</span>    pelagic <span class="dv">34</span> <span class="fl">15509.02</span> <span class="fl">0.0021922726</span> <span class="fl">2.430394</span> <span class="fl">1.979203</span> <span class="fl">0.4095139</span></span>
<span id="cb269-10"><a href="subgroups2.html#cb269-10" tabindex="-1"></a><span class="dv">23</span>   <span class="dv">23</span>    pelagic <span class="dv">32</span> <span class="fl">15218.69</span> <span class="fl">0.0021026776</span> <span class="fl">2.274882</span> <span class="fl">2.100172</span> <span class="fl">0.2020274</span></span>
<span id="cb269-11"><a href="subgroups2.html#cb269-11" tabindex="-1"></a><span class="dv">270</span> <span class="dv">270</span>    pelagic <span class="dv">16</span> <span class="fl">15989.49</span> <span class="fl">0.0010006575</span> <span class="fl">2.298740</span> <span class="fl">2.204043</span> <span class="fl">0.2728862</span></span>
<span id="cb269-12"><a href="subgroups2.html#cb269-12" tabindex="-1"></a>               D     N</span>
<span id="cb269-13"><a href="subgroups2.html#cb269-13" tabindex="-1"></a><span class="dv">376</span> <span class="fl">0.0028455545</span>  <span class="dv">7042</span></span>
<span id="cb269-14"><a href="subgroups2.html#cb269-14" tabindex="-1"></a><span class="dv">59</span>  <span class="fl">0.0022231582</span>  <span class="dv">5501</span></span>
<span id="cb269-15"><a href="subgroups2.html#cb269-15" tabindex="-1"></a><span class="dv">343</span> <span class="fl">0.0009029553</span>  <span class="dv">2234</span></span>
<span id="cb269-16"><a href="subgroups2.html#cb269-16" tabindex="-1"></a><span class="dv">469</span> <span class="fl">0.0032868666</span>  <span class="dv">8134</span></span>
<span id="cb269-17"><a href="subgroups2.html#cb269-17" tabindex="-1"></a><span class="dv">23</span>  <span class="fl">0.0056368496</span> <span class="dv">13949</span></span>
<span id="cb269-18"><a href="subgroups2.html#cb269-18" tabindex="-1"></a><span class="dv">270</span> <span class="fl">0.0019122461</span>  <span class="dv">4732</span></span>
<span id="cb269-19"><a href="subgroups2.html#cb269-19" tabindex="-1"></a></span>
<span id="cb269-20"><a href="subgroups2.html#cb269-20" tabindex="-1"></a>results_eez<span class="sc">$</span>bootstraps <span class="sc">%&gt;%</span> tail</span>
<span id="cb269-21"><a href="subgroups2.html#cb269-21" tabindex="-1"></a>          i population n        L           er       ss      esw        g0</span>
<span id="cb269-22"><a href="subgroups2.html#cb269-22" tabindex="-1"></a><span class="fl">440.91</span>  <span class="dv">440</span>       NWHI <span class="dv">0</span> <span class="fl">15859.86</span> <span class="fl">0.0000000000</span> <span class="fl">2.439134</span> <span class="fl">2.073469</span> <span class="fl">0.3477603</span></span>
<span id="cb269-23"><a href="subgroups2.html#cb269-23" tabindex="-1"></a><span class="fl">756.131</span> <span class="dv">756</span>       NWHI <span class="dv">0</span> <span class="fl">16066.45</span> <span class="fl">0.0000000000</span> <span class="fl">2.236142</span> <span class="fl">2.458480</span> <span class="fl">0.3870128</span></span>
<span id="cb269-24"><a href="subgroups2.html#cb269-24" tabindex="-1"></a><span class="fl">786.91</span>  <span class="dv">786</span>       NWHI <span class="dv">0</span> <span class="fl">15402.10</span> <span class="fl">0.0000000000</span> <span class="fl">2.311024</span> <span class="fl">2.572111</span> <span class="fl">0.4885364</span></span>
<span id="cb269-25"><a href="subgroups2.html#cb269-25" tabindex="-1"></a><span class="fl">968.10</span>  <span class="dv">968</span>       NWHI <span class="dv">6</span> <span class="fl">15290.70</span> <span class="fl">0.0003923953</span> <span class="fl">2.349685</span> <span class="fl">2.453244</span> <span class="fl">0.2911908</span></span>
<span id="cb269-26"><a href="subgroups2.html#cb269-26" tabindex="-1"></a><span class="fl">960.91</span>  <span class="dv">960</span>       NWHI <span class="dv">0</span> <span class="fl">15560.67</span> <span class="fl">0.0000000000</span> <span class="fl">2.433543</span> <span class="fl">2.450726</span> <span class="fl">0.3853660</span></span>
<span id="cb269-27"><a href="subgroups2.html#cb269-27" tabindex="-1"></a><span class="fl">513.11</span>  <span class="dv">513</span>       NWHI <span class="dv">0</span> <span class="fl">15539.13</span> <span class="fl">0.0000000000</span> <span class="fl">2.230709</span> <span class="fl">2.531903</span> <span class="fl">0.4734784</span></span>
<span id="cb269-28"><a href="subgroups2.html#cb269-28" tabindex="-1"></a>                   D    N</span>
<span id="cb269-29"><a href="subgroups2.html#cb269-29" tabindex="-1"></a><span class="fl">440.91</span>  <span class="fl">0.0000000000</span>    <span class="dv">0</span></span>
<span id="cb269-30"><a href="subgroups2.html#cb269-30" tabindex="-1"></a><span class="fl">756.131</span> <span class="fl">0.0000000000</span>    <span class="dv">0</span></span>
<span id="cb269-31"><a href="subgroups2.html#cb269-31" tabindex="-1"></a><span class="fl">786.91</span>  <span class="fl">0.0000000000</span>    <span class="dv">0</span></span>
<span id="cb269-32"><a href="subgroups2.html#cb269-32" tabindex="-1"></a><span class="fl">968.10</span>  <span class="fl">0.0006453348</span> <span class="dv">1597</span></span>
<span id="cb269-33"><a href="subgroups2.html#cb269-33" tabindex="-1"></a><span class="fl">960.91</span>  <span class="fl">0.0000000000</span>    <span class="dv">0</span></span>
<span id="cb269-34"><a href="subgroups2.html#cb269-34" tabindex="-1"></a><span class="fl">513.11</span>  <span class="fl">0.0000000000</span>    <span class="dv">0</span></span></code></pre></div>
<p>Some examples:</p>
<p><img src="figures/unnamed-chunk-333-1.png" width="672" /></p>
<p><img src="figures/unnamed-chunk-334-1.png" width="672" /></p>
<p><img src="figures/unnamed-chunk-335-1.png" width="672" /></p>
</div>
<div id="behind-the-scenes-2" class="section level2 unnumbered hasAnchor">
<h2>Behind the scenes<a href="subgroups2.html#behind-the-scenes-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This function performs the following operations:</p>
<ol style="list-style-type: decimal">
<li><p>Fits a detection function to <code>df_sits</code> without covariates, using the <code>LTabundR</code> function <code>df_fit()</code>, in order to estimate the effective strip width (ESW).</p></li>
<li><p>Conducts bootstrap re-sampling of the detection function fitting routine in order to estimate the CV of ESW.</p></li>
<li><p>Estimates the arithmetic mean subgroup size based on the <code>ss</code> input.</p></li>
<li><p>Creates a bootstrap-resampled distribution of subgroup sizes, with which CV is estimated.</p></li>
<li><p><em>Optional:</em> models the <em>Relative g(0)</em> in different survey conditions using the <code>LTabundR</code> function <code>g0_model()</code>. This function also estimates the CV of the <em>Rg(0)</em> estimate in each Beaufort sea state using jackknife resampling.</p></li>
<li><p>Estimates the encounter rate for each population (subgroup detections / trackline surveyed). If any sighting has a prorated population assignment, the number of subgroups used in each population is determined by multiplying the number of subgroups by the population’s probability. For example, sighting 133 above, which involved 6 subgroups, has a 0.6 probability of belonging to the pelagic population and a 0.4 probabilty of belonging to the NWHI population. Therefore, for the encounter rate, this sighting contributed 3.6 subgroups to the pelagic population (<code>6 * 0.6</code>) and 2.4 subgroups to the NWHI population (<code>6 * 0.4</code>).</p></li>
<li><p>Creates a bootstrap-resampled distribution of encounter rate estimates. If any sighting has a prorated population assignment, it will be assigned to only one population for each iteration based on a stochastic routine that compares a randomly drawn value between 0 and 1 to the population assignment probabilities. This is explained in further detail in <a href="https://repository.library.noaa.gov/view/noaa/24756">Bradford et al. (2020)</a>.</p></li>
<li><p>Calculates an empirical weighted <em>g(0)</em> estimate according to the proportion of effort occurring in each Beaufort sea state, then uses an automated parameter MCMC optimization routine (see details in <code>LTabundR</code> function <code>g0_weighted()</code>) to estimate the CV of the weighted <em>g(0)</em> estimate.</p></li>
<li><p>Creates a bootstrap-resampled distribution of the weighted <em>g(0)</em> estimate.</p></li>
<li><p>Estimates density using the point estimates of effective strip width, subgroup size, <em>g(0)</em>, and the encounter rate.</p></li>
<li><p>Estimates abundance by scaling the density estimate by the provided <code>abundance_area</code> input.</p></li>
<li><p>Creates a bootstrap-resampled distribution of the density estimate by iteratively drawing values from the resampled distributions of the constituent parameters of the density equation.</p></li>
<li><p>Creates a bootstrap-resampled distribution of the abundance estimate by scaling the density distribution by the <code>abundance_area</code> input.</p></li>
</ol>
<p>Note that this approach could theoretically be used for other species that occur in subgroups.</p>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="trend-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="diagnostic-plots.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
